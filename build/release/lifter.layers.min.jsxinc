/*!
 * Copyright N/A (see below)
 *
 * This is a wrapper for dependencies. See individual libs for Copyright info
 *
 */
;if(typeof[].map!=="function"){$.strict=false;if(!Array.prototype.some){Array.prototype.some=function(callback,thisArg){if(this===void 0||this===null){throw new TypeError("Array.prototype.some called on null or undefined");}if(callback.__class__!=="Function"){throw new TypeError(callback+" is not a function");}var t=Object(this);var len=t.length>>>0;var T=arguments.length>1?thisArg:void 0;for(var i=0;i<len;i++){if(i in t&&callback.call(T,t[i],i,t)){return true;}}return false;};}if(!Array.prototype.every){Array.prototype.every=function(callback,thisArg){var T,k;if(this===void 0||this===null){throw new TypeError("Array.prototype.every called on null or undefined");}var O=Object(this);var len=O.length>>>0;if(callback.__class__!=="Function"){throw new TypeError(callback+" is not a function");}T=(arguments.length>1)?thisArg:void 0;k=0;while(k<len){var kValue;if(k in O){kValue=O[k];var testResult=callback.call(T,kValue,k,O);if(!testResult){return false;}}k++;}return true;};}if(!Array.prototype.filter){Array.prototype.filter=function(callback,thisArg){if(this===void 0||this===null){throw new TypeError("Array.prototype.filter called on null or undefined");}var t=Object(this);var len=t.length>>>0;if(callback.__class__!=="Function"){throw new TypeError(callback+" is not a function");}var res=[];var T=(arguments.length>1)?thisArg:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(callback.call(T,val,i,t)){res.push(val);}}}return res;};}if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){if(this===void 0||this===null){throw new TypeError("Array.prototype.forEach called on null or undefined");}var O=Object(this);var len=O.length>>>0;if(callback.__class__!=="Function"){throw new TypeError(callback+" is not a function");}var T=(arguments.length>1)?thisArg:void 0;for(var k=0;k<len;k++){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}}};}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement,fromIndex){if(this===void 0||this===null){throw new TypeError("Array.prototype.indexOf called on null or undefined");}var k;var o=Object(this);var len=o.length>>>0;if(len===0){return -1;}var n=+fromIndex||0;if(Math.abs(n)===Infinity){n=0;}if(n>=len){return -1;}k=Math.max(n>=0?n:len-Math.abs(n),0);while(k<len){if(k in o&&o[k]===searchElement){return k;}k++;}return -1;};}if(!Array.isArray){Array.isArray=function(arg){if(arg===void 0||arg===null){return false;}return(arg.__class__==="Array");};}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(searchElement,fromIndex){if(this===void 0||this===null){throw new TypeError("Array.prototype.lastIndexOf called on null or undefined");}var n,k,t=Object(this),len=t.length>>>0;if(len===0){return -1;}n=len-1;if(arguments.length>1){n=Number(arguments[1]);if(n!=n){n=0;}else{if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}}for(k=n>=0?Math.min(n,len-1):len-Math.abs(n);k>=0;k--){if(k in t&&t[k]===searchElement){return k;}}return -1;};}if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this===void 0||this===null){throw new TypeError("Array.prototype.map called on null or undefined");}var O=Object(this);var len=O.length>>>0;if(callback.__class__!=="Function"){throw new TypeError(callback+" is not a function");}T=(arguments.length>1)?thisArg:void 0;A=new Array(len);for(var k=0;k<len;k++){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}}return A;};}if(!Array.prototype.reduce){Array.prototype.reduce=function(callback,initialValue){if(this===void 0||this===null){throw new TypeError("Array.prototype.reduce called on null or undefined");}if(callback.__class__!=="Function"){throw new TypeError(callback+" is not a function");}var t=Object(this),len=t.length>>>0,k=0,value;if(arguments.length>1){value=initialValue;}else{while(k<len&&!(k in t)){k++;}if(k>=len){throw new TypeError("Reduce of empty array with no initial value");}value=t[k++];}for(;k<len;k++){if(k in t){value=callback(value,t[k],k,t);}}return value;};}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(callback,initialValue){if(this===void 0||this===null){throw new TypeError("Array.prototype.reduceRight called on null or undefined");}if(callback.__class__!=="Function"){throw new TypeError(callback+" is not a function");}var t=Object(this),len=t.length>>>0,k=len-1,value;if(arguments.length>1){value=initialValue;}else{while(k>=0&&!(k in t)){k--;}if(k<0){throw new TypeError("Reduce of empty array with no initial value");}value=t[k--];}for(;k>=0;k--){if(k in t){value=callback(value,t[k],k,t);}}return value;};}if(!Date.prototype.toISOString){(function(){function pad(number){if(number<10){return"0"+number;}return number;}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+pad(this.getUTCMonth()+1)+"-"+pad(this.getUTCDate())+"T"+pad(this.getUTCHours())+":"+pad(this.getUTCMinutes())+":"+pad(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1000).toFixed(3).slice(2,5)+"Z";};}());}if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(this.__class__!=="Function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};if(this.prototype){fNOP.prototype=this.prototype;}fBound.prototype=new fNOP();return fBound;};}if(!Object.create){Object.create=(function(){function Temp(){}var hasOwn=Object.prototype.hasOwnProperty;return function(O){if(Object(O)!==O&&O!==null){throw TypeError("Object prototype may only be an Object or null");}Temp.prototype=O;var obj=new Temp();Temp.prototype=null;if(arguments.length>1){var Properties=Object(arguments[1]);for(var prop in Properties){if(hasOwn.call(Properties,prop)){var descriptor=Properties[prop];if(Object(descriptor)!==descriptor){throw TypeError(prop+"must be an object");}if("get" in descriptor||"set" in descriptor){throw new TypeError("getters & setters can not be defined on this javascript engine");}if("value" in descriptor){obj[prop]=Properties[prop];}}}}return obj;};})();}if(!Object.defineProperties){Object.defineProperties=function(object,props){function hasProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop);}function convertToDescriptor(desc){if(Object(desc)!==desc){throw new TypeError("Descriptor can only be an Object.");}var d={};if(hasProperty(desc,"enumerable")){d.enumerable=!!desc.enumerable;}if(hasProperty(desc,"configurable")){d.configurable=!!desc.configurable;}if(hasProperty(desc,"value")){d.value=desc.value;}if(hasProperty(desc,"writable")){d.writable=!!desc.writable;}if(hasProperty(desc,"get")){throw new TypeError("getters & setters can not be defined on this javascript engine");}if(hasProperty(desc,"set")){throw new TypeError("getters & setters can not be defined on this javascript engine");}return d;}if(Object(object)!==object){throw new TypeError("Object.defineProperties can only be called on Objects.");}if(Object(props)!==props){throw new TypeError("Properties can only be an Object.");}var properties=Object(props);for(propName in properties){if(hasOwnProperty.call(properties,propName)){var descr=convertToDescriptor(properties[propName]);object[propName]=descr.value;}}return object;};}if(!Object.defineProperty){Object.defineProperty=function defineProperty(object,property,descriptor){if(Object(object)!==object){throw new TypeError("Object.defineProperty can only be called on Objects.");}if(Object(descriptor)!==descriptor){throw new TypeError("Property description can only be an Object.");}if("get" in descriptor||"set" in descriptor){throw new TypeError("getters & setters can not be defined on this javascript engine");}if("value" in descriptor){object[property]=descriptor.value;}return object;};}if(!Object.freeze){Object.freeze=function freeze(object){if(Object(object)!==object){throw new TypeError("Object.freeze can only be called on Objects.");}return object;};}if(!Object.getOwnPropertyDescriptor){Object.getOwnPropertyDescriptor=function getOwnPropertyDescriptor(object,property){if(Object(object)!==object){throw new TypeError("Object.getOwnPropertyDescriptor can only be called on Objects.");}var descriptor;if(!Object.prototype.hasOwnProperty.call(object,property)){return descriptor;}descriptor={enumerable:Object.prototype.propertyIsEnumerable.call(object,property),configurable:true};descriptor.value=object[property];var psPropertyType=object.reflect.find(property).type;descriptor.writable=!(psPropertyType==="readonly");return descriptor;};}if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function getOwnPropertyNames(object){if(Object(object)!==object){throw new TypeError("Object.getOwnPropertyNames can only be called on Objects.");}var names=[];var hasOwnProperty=Object.prototype.hasOwnProperty;var propertyIsEnumerable=Object.prototype.propertyIsEnumerable;for(var prop in object){if(hasOwnProperty.call(object,prop)){names.push(prop);}}var properties=object.reflect.properties;var methods=object.reflect.methods;var all=methods.concat(properties);for(var i=0;i<all.length;i++){var prop=all[i].name;if(hasOwnProperty.call(object,prop)&&!(propertyIsEnumerable.call(object,prop))){names.push(prop);}}return names;};}if(!Object.getPrototypeOf){Object.getPrototypeOf=function(object){if(Object(object)!==object){throw new TypeError("Object.getPrototypeOf can only be called on Objects.");}return object.__proto__;};}if(!Object.isExtensible){Object.isExtensible=function isExtensible(object){if(Object(object)!==object){throw new TypeError("Object.isExtensible can only be called on Objects.");}return true;};}if(!Object.isFrozen){Object.isFrozen=function isFrozen(object){if(Object(object)!==object){throw new TypeError("Object.isFrozen can only be called on Objects.");}return false;};}if(!Object.isSealed){Object.isSealed=function isSealed(object){if(Object(object)!==object){throw new TypeError("Object.isSealed can only be called on Objects.");}return false;};}if(!Object.keys){Object.keys=function(object){if(Object(object)!==object){throw new TypeError("Object.keys can only be called on Objects.");}var hasOwnProperty=Object.prototype.hasOwnProperty;var result=[];for(var prop in object){if(hasOwnProperty.call(object,prop)){result.push(prop);}}return result;};}if(!Object.preventExtensions){Object.preventExtensions=function preventExtensions(object){if(Object(object)!==object){throw new TypeError("Object.preventExtensions can only be called on Objects.");}return object;};}if(!Object.seal){Object.seal=function seal(object){if(Object(object)!==object){throw new TypeError("Object.seal can only be called on Objects.");}return object;};}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");};}
/*! JSON v3.3.2 | https://bestiejs.github.io/json3 | Copyright 2012-2015, Kit Cambridge, Benjamin Tan | http://kit.mit-license.org */
;(function(){var isLoader=typeof define==="function"&&define.amd;var objectTypes={"function":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global=="object"&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)){root=freeGlobal;}function runInContext(context,exports){context||(context=root.Object());exports||(exports=root.Object());var Number=context.Number||root.Number,String=context.String||root.String,Object=context.Object||root.Object,Date=context.Date||root.Date,SyntaxError=context.SyntaxError||root.SyntaxError,TypeError=context.TypeError||root.TypeError,Math=context.Math||root.Math,nativeJSON=context.JSON||root.JSON;if(typeof nativeJSON=="object"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse;}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty=objectProto.hasOwnProperty,undefined;function attempt(func,errorFunc){try{func();}catch(exception){if(errorFunc){errorFunc();}}}var isExtended=new Date(-3509827334573292);attempt(function(){isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708;});function has(name){if(has[name]!=null){return has[name];}var isSupported;if(name=="bug-string-char-index"){isSupported="a"[0]!="a";}else{if(name=="json"){isSupported=has("json-stringify")&&has("date-serialization")&&has("json-parse");}else{if(name=="date-serialization"){isSupported=has("json-stringify")&&isExtended;if(isSupported){var stringify=exports.stringify;attempt(function(){isSupported=stringify(new Date(-8640000000000000))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(8640000000000000))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date(-62198755200000))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"';});}}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(name=="json-stringify"){var stringify=exports.stringify,stringifySupported=typeof stringify=="function";if(stringifySupported){(value=function(){return 1;}).toJSON=value;attempt(function(){stringifySupported=stringify(0)==="0"&&stringify(new Number())==="0"&&stringify(new String())=='""'&&stringify(getClass)===undefined&&stringify(undefined)===undefined&&stringify()===undefined&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undefined])=="[null]"&&stringify(null)=="null"&&stringify([undefined,getClass,null])=="[null,null,null]"&&stringify({a:[value,true,false,null,"\x00\b\n\f\r\t"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]";},function(){stringifySupported=false;});}isSupported=stringifySupported;}if(name=="json-parse"){var parse=exports.parse,parseSupported;if(typeof parse=="function"){attempt(function(){if(parse("0")===0&&!parse(false)){value=parse(serialized);parseSupported=value.a.length==5&&value.a[0]===1;if(parseSupported){attempt(function(){parseSupported=!parse('"\t"');});if(parseSupported){attempt(function(){parseSupported=parse("01")!==1;});}if(parseSupported){attempt(function(){parseSupported=parse("1.")!==1;});}}}},function(){parseSupported=false;});}isSupported=parseSupported;}}}}return has[name]=!!isSupported;}has["bug-string-char-index"]=has["date-serialization"]=has.json=has["json-stringify"]=has["json-parse"]=null;if(!has("json")){var functionClass="[object Function]",dateClass="[object Date]",numberClass="[object Number]",stringClass="[object String]",arrayClass="[object Array]",booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");var forOwn=function(object,callback){var size=0,Properties,dontEnums,property;(Properties=function(){this.valueOf=0;}).prototype.valueOf=0;dontEnums=new Properties();for(property in dontEnums){if(isProperty.call(dontEnums,property)){size++;}}Properties=dontEnums=null;if(!size){dontEnums=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forOwn=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!="function"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property=="prototype")&&hasProperty.call(object,property)){callback(property);}}for(length=dontEnums.length;property=dontEnums[--length];){if(hasProperty.call(object,property)){callback(property);}}};}else{forOwn=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor")){callback(property);}}if(isConstructor||isProperty.call(object,(property="constructor"))){callback(property);}};}return forOwn(object,callback);};if(!has("json-stringify")&&!has("date-serialization")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width);};var serializeDate=function(value){var getData,year,month,date,time,hours,minutes,seconds,milliseconds;if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400);};getData=function(value){date=floor(value/86400000);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++){}for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++){}date=1+date-getDay(year,month);time=(value%86400000+86400000)%86400000;hours=floor(time/3600000)%24;minutes=floor(time/60000)%60;seconds=floor(time/1000)%60;milliseconds=time%1000;};}else{getData=function(value){year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds();};}serializeDate=function(value){if(value>-1/0&&value<1/0){getData(value);value=(year<=0||year>=10000?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z";year=month=date=hours=minutes=seconds=milliseconds=null;}else{value=null;}return value;};return serializeDate(value);};if(has("json-stringify")&&!has("date-serialization")){function dateToJSON(key){return serializeDate(this);}var nativeStringify=exports.stringify;exports.stringify=function(source,filter,width){var nativeToJSON=Date.prototype.toJSON;Date.prototype.toJSON=dateToJSON;var result=nativeStringify(source,filter,width);Date.prototype.toJSON=nativeToJSON;return result;};}else{var unicodePrefix="\\u00";var escapeChar=function(character){var charCode=character.charCodeAt(0),escaped=Escapes[charCode];if(escaped){return escaped;}return unicodePrefix+toPaddedString(2,charCode.toString(16));};var reEscape=/[\x00-\x1f\x22\x5c]/g;var quote=function(value){reEscape.lastIndex=0;return'"'+(reEscape.test(value)?value.replace(reEscape,escapeChar):value)+'"';};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,type,className,results,element,index,length,prefix,result;attempt(function(){value=object[property];});if(typeof value=="object"&&value){if(value.getUTCFullYear&&getClass.call(value)==dateClass&&value.toJSON===Date.prototype.toJSON){value=serializeDate(value);}else{if(typeof value.toJSON=="function"){value=value.toJSON(property);}}}if(callback){value=callback.call(object,property,value);}if(value==undefined){return value===undefined?value:"null";}type=typeof value;if(type=="object"){className=getClass.call(value);}switch(className||type){case"boolean":case booleanClass:return""+value;case"number":case numberClass:return value>-1/0&&value<1/0?""+value:"null";case"string":case stringClass:return quote(""+value);}if(typeof value=="object"){for(length=stack.length;length--;){if(stack[length]===value){value=TypeError();}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undefined?"null":element);}result=results.length?(whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":("["+results.join(",")+"]")):"[]";}else{forOwn(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undefined){results.push(quote(property)+":"+(whitespace?" ":"")+element);}});result=results.length?(whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":("{"+results.join(",")+"}")):"{}";}stack.pop();return result;}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){className=getClass.call(filter);if(className==functionClass){callback=filter;}else{if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;){value=filter[index++];className=getClass.call(value);if(className=="[object String]"||className=="[object Number]"){properties[value]=1;}}}}}if(width){className=getClass.call(width);if(className==numberClass){if((width-=width%1)>0){if(width>10){width=10;}for(whitespace="";whitespace.length<width;){whitespace+=" ";}}}else{if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10);}}}return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[]);};}}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError();};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort();}else{if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort();}}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort();}}else{if(charCode==34){break;}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index);}value+=source.slice(begin,Index);}}}if(source.charCodeAt(Index)==34){Index++;return value;}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index);}if(charCode>=48&&charCode<=57){if(charCode==48&&((charCode=source.charCodeAt(Index+1)),charCode>=48&&charCode<=57)){abort();}isSigned=false;for(;Index<length&&((charCode=source.charCodeAt(Index)),charCode>=48&&charCode<=57);Index++){}if(source.charCodeAt(Index)==46){position=++Index;for(;position<length;position++){charCode=source.charCodeAt(position);if(charCode<48||charCode>57){break;}}if(position==Index){abort();}Index=position;}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++;}for(position=Index;position<length;position++){charCode=source.charCodeAt(position);if(charCode<48||charCode>57){break;}}if(position==Index){abort();}Index=position;}return +source.slice(begin,Index);}if(isSigned){abort();}var temp=source.slice(Index,Index+4);if(temp=="true"){Index+=4;return true;}else{if(temp=="fals"&&source.charCodeAt(Index+4)==101){Index+=5;return false;}else{if(temp=="null"){Index+=4;return null;}}}abort();}}return"$";};var get=function(value){var results,hasMembers;if(value=="$"){abort();}if(typeof value=="string"){if((charIndexBuggy?value.charAt(0):value[0])=="@"){return value.slice(1);}if(value=="["){results=[];for(;;){value=lex();if(value=="]"){break;}if(hasMembers){if(value==","){value=lex();if(value=="]"){abort();}}else{abort();}}else{hasMembers=true;}if(value==","){abort();}results.push(get(value));}return results;}else{if(value=="{"){results={};for(;;){value=lex();if(value=="}"){break;}if(hasMembers){if(value==","){value=lex();if(value=="}"){abort();}}else{abort();}}else{hasMembers=true;}if(value==","||typeof value!="string"||(charIndexBuggy?value.charAt(0):value[0])!="@"||lex()!=":"){abort();}results[value.slice(1)]=get(lex());}return results;}}abort();}return value;};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undefined){delete source[property];}else{source[property]=element;}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(getClass,forOwn,value,length,callback);}}else{forOwn(value,function(property){update(value,property,callback);});}}return callback.call(source,property,value);};exports.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$"){abort();}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result;};}}exports.runInContext=runInContext;return exports;}if(freeExports&&!isLoader){runInContext(root,freeExports);}else{var nativeJSON=root.JSON,previousJSON=root.JSON3,isRestored=false;var JSON3=runInContext(root,(root.JSON3={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root.JSON3=previousJSON;nativeJSON=previousJSON=null;}return JSON3;}}));root.JSON={parse:JSON3.parse,stringify:JSON3.stringify};}if(isLoader){define(function(){return JSON3;});}}).call(this);if($&&$.global){if(typeof Log!=="function"){Log=function Log(){};Log.log=Log.info=Log.warn=Log.error=function(logIn){$.writeln(logIn);};}if(typeof $.global.log=="undefined"){$.global.log=Log;}if(typeof $.global.console=="undefined"){$.global.console=Log;}}if(!String.prototype.repeat){String.prototype.repeat=function(count){if(this==null){throw new TypeError("can't convert "+this+" to object");}var str=""+this;count=+count;if(count<0){throw new RangeError("repeat count must be non-negative");}if(count==Infinity){throw new RangeError("repeat count must be less than infinity");}count|=0;if(str.length==0||count==0){return"";}str=Array(count+1).join(str);return str;};}if(!String.prototype.padStart){String.prototype.padStart=function padStart(targetLength,padString){targetLength=targetLength>>0;padString=String(typeof padString!=="undefined"?padString:" ");if(this.length>=targetLength){return String(this);}else{targetLength=targetLength-this.length;if(targetLength>padString.length){padString+=padString.repeat(targetLength/padString.length);}return padString.slice(0,targetLength)+String(this);}};}if(!String.prototype.padEnd){String.prototype.padEnd=function padEnd(targetLength,padString){targetLength=targetLength>>0;padString=String((typeof padString!=="undefined"?padString:" "));if(this.length>targetLength){return String(this);}else{targetLength=targetLength-this.length;if(targetLength>padString.length){padString+=padString.repeat(targetLength/padString.length);}return String(this)+padString.slice(0,targetLength);}};}if(!Array.prototype.includes){Array.prototype.includes=function(searchElement,fromIndex){if(this==null){throw new TypeError('"this" is null or not defined');}var o=Object(this);var len=o.length>>>0;if(len===0){return false;}var n=fromIndex|0;var k=Math.max(n>=0?n:len-Math.abs(n),0);function sameValueZero(x,y){return x===y||(typeof x==="number"&&typeof y==="number"&&isNaN(x)&&isNaN(y));}while(k<len){if(sameValueZero(o[k],searchElement)){return true;}k++;}return false;};}(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory);}else{if(typeof module==="object"&&module.exports){module.exports=factory;}else{root.ExtendScript_LogFile=factory;}}}($.global,function(root,logType,logDir,useDate){$.strict=true;$.writeln("Loading extendscript LogFile...");var LogFile={};var _logDir=logDir;var _useDate=(useDate!==false);function _createLogFile(typeString){var logFileDir=new Folder(_getDirString());if(!logFileDir.exists){logFileDir.create();}var logFileName=typeString+"_"+_getDateString().replace(/[:]/g,"-")+".log";var logFilePath=_getDirString()+logFileName;return new File(logFilePath);}function _removeLogFiles(keepLatest){var typeString=_getTypeString();var removeTime=(LogFile.file instanceof File&&LogFile.file.exists)?LogFile.file.created.getTime():new Date().getTime();var logFileDir=new Folder(_getDirString());if(logFileDir.exists){var logFiles=logFileDir.getFiles();for(f=0;f<logFiles.length;f++){var myFile=logFiles[f];var fileTime=myFile.created.getTime();var nameSearch=myFile.name.search(typeString+"_");if((fileTime<removeTime||keepLatest==false)&&nameSearch>-1){myFile.remove();}}}}function _getTypeString(){return LogFile.type||"default";}function _getDirString(){var dirPath;if(_logDir){dirPath=_logDir;}else{if(File($.fileName).exists){dirPath=File($.fileName).path+"/logs/";}else{dirPath=Folder.desktop+"/ExtendScript_Log_UnsavedScripts/";}}return dirPath;}function _getDateString(){var myDate=new Date();if(typeof myDate.getFullYear!=="function"){myDate.getFullYear=function(){return(myDate.getYear+1900);};}var myYear=myDate.getFullYear().toString();var myMonth=_zeroPad(myDate.getMonth()+1,2);var myDay=_zeroPad(myDate.getDate(),2);var myHours=_zeroPad(myDate.getHours(),2);var myMinutes=_zeroPad(myDate.getMinutes(),2);var mySeconds=_zeroPad(myDate.getSeconds(),2);return myYear+"-"+myMonth+"-"+myDay+"T"+myHours+":"+myMinutes+":"+mySeconds+"."+(myDate.getMilliseconds()/1000).toFixed(3).slice(2,5);}function _zeroPad(num,numZeros){var absNum=Math.abs(num);var zeros=Math.max(0,numZeros-Math.floor(absNum).toString().length);var zeroString=Math.pow(10,zeros).toString().substr(1);if(num<0){zeroString="-"+zeroString;}return zeroString+absNum;}LogFile.init=function(logType){LogFile.type=logType;LogFile.directory=_getDirString();LogFile.file=_createLogFile(_getTypeString());$.writeln("Initializing new LogFile: "+LogFile.file.path);return LogFile;};LogFile.writeln=LogFile.log=function(logMessage){LogFile.file.open("a+");if(_useDate){logMessage="["+_getDateString()+"] "+logMessage;}LogFile.file.writeln(logMessage);LogFile.file.close();return LogFile;};LogFile.clear=function(){LogFile.file.open("w");LogFile.file.close();return LogFile;};LogFile.remove=function(){if(File(LogFile.file).exists){LogFile.file.remove();}return LogFile;};LogFile.removeOld=function(){_removeLogFiles();return LogFile;};LogFile.removeAll=function(){_removeLogFiles(false);return LogFile;};LogFile.setDirectory=function(newDir){_logDir=newDir;LogFile.init(LogFile.type);return LogFile;};LogFile.useDate=function(useDate){_useDate=(useDate!==false);LogFile.init(LogFile.type);return LogFile;};if(root){root.logfile=LogFile;}return LogFile.init(logType);}));(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory);}else{if(typeof module==="object"&&module.exports){module.exports=factory;}else{root.ExtendScript_Log=factory;}}}($.global,function(root,logName,logLevel,useLogFile,keepOldLogs,logFileDir){$.strict=true;$.writeln("Loading extendscript Log...");var Log={};Log.level=0;Log.logFile=null;Log.levels={};Log.type="";try{var _xLib=new ExternalObject("lib:PlugPlugExternalObject");}catch(err){$.writeln("[ERROR] Could not create ExternalObject for event handling. No CEP support.");}_getExceptionMessage=function _getExceptionMessage(e){var fname,str;fname=!e.fileName?"???":decodeURI(e.fileName);str="\tMessage: "+e.message+"\n\tFile: "+fname+"\n\tLine: "+(e.line||"???")+"\n\tError Name: "+e.name+"\n\tError Number: "+e.number;if($.stack){str+="\n\tStack: "+$.stack.split("\n").join("\n\t  ");}return str;};_stringifyMessage=function _stringifyMessage(message){switch(typeof message){case"string":return message;case"function":message=message.toString();return/(function [^\{]*)/.exec(message)[1];default:if(JSON&&typeof JSON.stringify==="function"){return JSON.stringify(message);}else{return String(message);}}};Log.init=function(logName,logLevel,useLogFile,keepOldLogs,logFileDir){Log.level=(typeof logLevel=="number")?logLevel:0;Log.type=(typeof logName=="string")?logName.toLowerCase():"default";if(useLogFile&&typeof ExtendScript_LogFile=="function"){if(!Log.logFile){Log.logFile=new ExtendScript_LogFile(Log,logName,logFileDir);if(!keepOldLogs){Log.logFile.removeOld();}}}return Log;};Log.escapeControlCharacters=function(value){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var _escapeChar=function(character){var charCode=character.charCodeAt(0);var escaped=Escapes[charCode];if(escaped){return escaped;}return"\\u00"+toPaddedString(2,charCode.toString(16));};var reEscape=/[\x00-\x1f\x22\x5c]/g;reEscape.lastIndex=0;if(reEscape.test(value)){value=value.replace(reEscape,_escapeChar);}return value;};Log.log=function log(message,level,label,useAlert){var messageStr;var data={};var eventObj=new CSXSEvent();var prefix="";prefix+=(Log.type.length)?Log.type.toLowerCase()+" ":"";prefix+=(typeof label=="string"&&label.length)?"["+label.toLowerCase()+"] ":"";prefix+=(prefix.length)?": ":"";useAlert=(typeof level==="boolean")?level:useAlert;level=(typeof level==="number")?level:2;if(level<Log.level){return;}if(message instanceof Error){message.stack=$.stack.replace(/[:]/g,"\\:").split("\n");delete message.source;}messageStr=_stringifyMessage(message);messageStr=messageStr.replace(/[\u0000-\u0019]+/g,"");if(typeof _xLib!=="undefined"){if(typeof label!=="string"||!label.length){label="log";}data='{"type":"'+Log.type+'","level":"'+level+'","label":"'+label+'","message":"'+Log.escapeControlCharacters(messageStr)+'"}';eventObj.type="ExtendScript_Log";eventObj.data=data;eventObj.dispatch();}if(message instanceof Error){messageStr=prefix+" ERROR\n"+_getExceptionMessage(message);}else{messageStr=prefix+messageStr;}if($){$.writeln(messageStr);}if(Log.logFile instanceof Object&&Log.logFile.file instanceof File){Log.logFile.writeln(messageStr);}if(useAlert){alert(messageStr);}return Log;};Log.addLogLevel=function addLogLevel(name,level){name=name.toLowerCase();if(typeof Log.name=="function"&&!Log.levels.name){throw new Error("[ERROR] ExtendScript_Log can not make log level. Name "+name+"is reserved.");}Log.levels[name]=level;Log[name]=function(message,useAlert){return Log.log(message,level,name,useAlert);};return Log;};Log.removeLogLevel=function removeLogLevel(name){Log.levels[name.toLowerCase()]=undefined;return Log;};Log.clear=function clear(){$.sleep(1000);if(app.name==="ExtendScript Toolkit"){app.clc();}else{var estApp=BridgeTalk.getSpecifier("estoolkit");if(estApp){var bt=new BridgeTalk();bt.target=estApp;bt.body="app.clc()";bt.send();}}if(typeof _xLib!=="undefined"){var eventObj=new CSXSEvent();eventObj.type="ExtendScript_Log";eventObj.data='{"type":"'+Log.type+'","level":99,"label":"clear","message":""}';eventObj.dispatch();}if(Log.logFile instanceof Object&&Log.logFile.file instanceof File){Log.logFile.clear();}return Log;};Log.addLogLevel("critical",5);Log.addLogLevel("error",4);Log.addLogLevel("warn",3);Log.addLogLevel("info",2);Log.addLogLevel("debug",1);Log.addLogLevel("trace",0);if(root){root.log=Log;root.console=Log;}return Log.init(logName,logLevel,useLogFile,keepOldLogs,logFileDir);}));(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory);}else{if(typeof module==="object"&&module.exports){module.exports=factory;}else{root.ExtendScript_Dialogs=factory;}}}($.global,function(root,overrideNative){$.strict=true;try{log.log("");}catch(e){log={};log.log=function(i){$.writeln(i);};}log.log("Making extendscript Dialogs...");var _UICache={};var Dialogs={};var _addMessage=Dialogs.addMessage=function(w,id,message){if(message){w.message=w.add("statictext",undefined,message,{multiline:true});w.message.alignment="fill";w.message.maximumSize=[1000,1000];}return w;};var _addSkippable=Dialogs.addSkippable=function(w,id,skippable){if(skippable){w.cbNoAskAgain=w.add("checkbox",undefined,"Don't ask about this again.");w.cbNoAskAgain.onClick=function(){_UICache[id].skip=w.cbNoAskAgain.value;};}return w;};var _addButtons=Dialogs.addButtons=function(w,id,buttons,onClickFunction){var onClickDefault=function onClickDefault(){_UICache[id].value=Number(this.index);_UICache[id].button=Number(this.index);w.close(_UICache[id].value);};w.buttonGroup=w.add("group");w.buttonGroup.orientation="row";for(var btn in buttons){if(!buttons.hasOwnProperty(btn)){continue;}var newButton=w.buttonGroup.add('button {alignment:"fill",justify:"center"}');newButton.text=buttons[btn];newButton.index=btn;newButton.onClick=(typeof onClickFunction=="function")?onClickFunction:onClickDefault;}w.defaultElement=w.buttonGroup.children[(w.buttonGroup.children.length-1)];w.cancelElement=w.buttonGroup.children[0];return w;};Dialogs.getCached=function(id){if(typeof id==="undefined"){id=-1;}return _UICache[id];};Dialogs.clearCached=function(id){if(typeof id==="undefined"){id=-1;}_UICache[id]=undefined;};Dialogs.alert=function alertDialog(args){if(typeof args=="string"){args={text:args};}args.title=args.title||"Alert";args.text=args.text||"Something Happened!";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["OK"];return Dialogs.confirm(args);};Dialogs.confirm=function confirmDialog(args){if(typeof args=="string"){args={text:args};}args.title=args.title||"Confirm";args.text=args.text||"Do you agree?";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["Cancel","OK"];if(!_UICache.hasOwnProperty(args.id)||typeof _UICache[args.id]!=="object"){_UICache[args.id]={};}else{if(args.skippable===true&&_UICache[args.id].skip===true){return _UICache[args.id].value;}}var w=new Window("dialog",args.title);w.minimumSize=[155,50];_addMessage(w,args.id,args.text);_addSkippable(w,args.id,args.skippable);_addButtons(w,args.id,args.buttons);w.onShow=function(){w.layout.resize(true);};w.onResize=function(){if(w.message){w.message.size.width=w.size.width-10;}};w.center();return w.show();};Dialogs.prompt=function promptDialog(args,defaultText){function onClickDlgButton(){_UICache[args.id].button=Number(this.index);_UICache[args.id].value=this.window.prompt.text;w.close(Number(this.index));}if(typeof args=="string"){args={text:args,defaultText:defaultText};}args.title=args.title||"Prompt";args.text=args.text||"What is your answer?";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["Cancel","OK"];args.defaultText=args.defaultText||"";args.multiline=args.multiline||false;if(!_UICache.hasOwnProperty(args.id)||typeof _UICache[args.id]!=="object"){_UICache[args.id]={};}else{if(args.skippable===true&&_UICache[args.id].skip===true){return _UICache[args.id].value;}}var w=new Window("dialog",args.title);_addMessage(w,args.id,args.text);if(args.multiline){w.prompt=w.add("edittext",[0,0,150,70],args.defaultText,{multiline:true,wantReturn:true});}else{w.prompt=w.add("edittext",undefined,args.defaultText,{wantReturn:true});}w.prompt.alignment="fill";w.layout.layout();w.prompt.active=true;_addSkippable(w,args.id,args.skippable);_addButtons(w,args.id,args.buttons,onClickDlgButton);w.onShow=function(){w.layout.resize(true);};w.onResize=function(){if(w.message){w.message.size.width=w.size.width-10;}};w.center();if(w.show()!==0){return _UICache[args.id].value;}};Dialogs.dropdown=function dropdownDialog(args){function onClickDlgButton(){_UICache[args.id].button=Number(this.index);_UICache[args.id].value=this.window.dropdown.selection.text;w.close(Number(this.index));}if(Object.prototype.toString.call(args)==="[object Array]"){args={menuItems:args};}args.title=args.title||"Choose One";args.text=args.text||"";args.id=(typeof args.id=="number")?args.id:-1;args.skippable=args.skippable||false;args.buttons=args.buttons||["Cancel","OK"];args.menuItems=args.menuItems||["Item1","Item2"];if(!_UICache.hasOwnProperty(args.id)||typeof _UICache[args.id]!=="object"){_UICache[args.id]={};}else{if(args.skippable===true&&_UICache[args.id].skip===true){return _UICache[args.id].value;}}var w=new Window("dialog",args.title);w.minimumSize=[155,50];_addMessage(w,args.id,args.text);w.dropdown=w.add("dropdownlist",undefined,args.menuItems);w.dropdown.selection=0;_addSkippable(w,args.id,args.skippable);_addButtons(w,args.id,args.buttons,onClickDlgButton);w.onShow=function(){w.layout.resize(true);};w.onResize=function(){if(w.message){w.message.size.width=w.size.width-10;}};w.center();if(w.show()!==0){return _UICache[args.id].value;}};function alertNative(arg){var args=(typeof arg=="object")?arg:{title:"Alert",id:-1,text:arg,buttons:["OK"]};Dialogs.alert(args);}function confirmNative(arg){if(typeof arg=="object"){return Dialogs.confirm(arg);}else{return Boolean(Dialogs.confirm({title:"Confirm",id:-1,text:arg,buttons:["Cancel","OK"]}));}}function promptNative(args,defaultText){args=(typeof args=="object")?args:{title:"Prompt",id:-1,text:args,defaultText:defaultText,buttons:["Cancel","OK"]};return Dialogs.prompt(args);}if(root){root.Dialogs=Dialogs;if(root!==$.global){root.alert=alertNative;root.confirm=confirmNative;root.prompt=promptNative;}}if(overrideNative===true){$.sleep(200);$.global.alert=alertNative;$.global.confirm=confirmNative;$.global.prompt=promptNative;}return Dialogs;}));$.writeln("Libs for shims, shams, polyfills, and party hats loaded...");}else{console.debug("ES5 function [].map() found. Assume we already shim-shammed this party. Not reinitializing dependencies.");}
/*!
 * Libs for shims, shams, polyfills, and party hats loaded...
 */
;
/*!
 * Copyright 2014 Francesco Camarlinghi
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * 	http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
;if(typeof Lifter!=="object"){(function(){$.strict=true;var _DEVBUILD=false;$.writeln("Starting Lifter...");var Lifter=this.Lifter=function Lifter(){};var _dialogModesNo=DialogModes.NO,c2id=charIDToTypeID,s2id=stringIDToTypeID;var _rulerUnitCache=[];try{var _xLib=new ExternalObject("lib:PlugPlugExternalObject");}catch(err){throw new Error(['Could not create ExternalObject for event handling: \n"',err].join(""));}if(_DEVBUILD){Lifter.log=new ExtendScript_Log($.global,0,"Lifter",true,false);}else{Lifter.log=new ExtendScript_Log($.global,4,"Lifter",false);}if(typeof log!=="object"){log=Lifter.log;}Lifter.dialogs=new ExtendScript_Dialogs($.global,true);log.log("LOADING Lifter core ...");var Enumeration=this.Enumeration=function Enumeration(){};Enumeration.fromValue=function(enumeration,value){if(typeof enumeration!=="function"){throw new TypeError(['Invalid enumeration "',enumeration,'".'].join(""));}value=+value||0;var enumKeys=Object.keys(enumeration),enumerator;for(var i=0,n=enumKeys.length;i<n;i++){enumerator=enumeration[enumKeys[i]];if(enumerator.valueOf&&enumerator.valueOf()===value){return enumerator;}}return null;};Enumeration.contains=function(enumeration,value){return Enumeration.fromValue(enumeration,value)!==null;};Enumeration.toArray=function(enumeration){if(typeof enumeration!=="function"){throw new TypeError(['Invalid enumeration "',enumeration,'".'].join(""));}var enumKeys=Object.keys(enumeration),enumKeysLength=enumKeys.length,enumerator,result=[];for(var i=0;i<enumKeysLength;i++){enumerator=enumeration[enumKeys[i]];if(enumerator instanceof Enumerator){result.push(enumerator);}}return result;};var Enumerator=this.Enumerator=function Enumerator(name,value){this.__name=name;this.__value=value;};Enumerator.prototype={toString:function(){return this.__name;},valueOf:function(){return this.__value;},"+":function(operand,rev){return undefined;},"-":function(operand,rev){return undefined;},"*":function(operand,rev){return undefined;},"/":function(operand,rev){return undefined;},"~":function(operand,rev){return undefined;},"===":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()===this.valueOf();},"==":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()==this.valueOf();},"<":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{return this.valueOf()<operand.valueOf();}},"<=":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{if(rev){return this.valueOf()>=operand.valueOf();}else{return this.valueOf()<=operand.valueOf();}}}};var UnitDouble=this.UnitDouble=function UnitDouble(unitType,doubleValue){this.unitType=unitType;this.doubleValue=doubleValue;};UnitDouble.prototype={toString:function(){return this.unitType+" = "+this.doubleValue;},valueOf:function(){return this.doubleValue;},"+":function(operand,rev){return this.doubleValue+operand;},"-":function(operand,rev){return(rev)?operand-this.doubleValue:this.doubleValue-operand;},"*":function(operand,rev){return this.doubleValue*operand;},"/":function(operand,rev){return(rev)?operand/this.doubleValue:this.doubleValue/operand;},"~":function(operand,rev){return undefined;},"===":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()===this.valueOf();},"==":function(operand,rev){return(!operand||!operand.valueOf)?false:operand.valueOf()==this.valueOf();},"<":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{return this.valueOf()<operand.valueOf();}},"<=":function(operand,rev){if(!operand||!operand.valueOf){return undefined;}else{if(rev){return this.valueOf()>=operand.valueOf();}else{return this.valueOf()<=operand.valueOf();}}}};var LayerBounds=this.LayerBounds=function LayerBounds(top,left,bottom,right){this.top=new UnitValue(top,"px");this.left=new UnitValue(left,"px");this.bottom=new UnitValue(bottom,"px");this.right=new UnitValue(right,"px");};LayerBounds.prototype={toString:function(){return[this.top,this.left,this.bottom,this.right].join(", ");},valueOf:function(){return undefined;},"+":function(operand,rev){return undefined;},"-":function(operand,rev){return undefined;},"*":function(operand,rev){return undefined;},"/":function(operand,rev){return undefined;},"~":function(operand,rev){return undefined;},"===":function(operand,rev){return(!operand)?false:(operand.top===this.top&&operand.left===this.left&&operand.bottom===this.bottom&&operand.right===this.right);},"==":function(operand,rev){return operand===this;},"<":function(operand,rev){return undefined;},"<=":function(operand,rev){return undefined;}};var LayerType=this.LayerType=function LayerType(){};LayerType.SETSTART=new Enumerator("LayerType.SETSTART",0);LayerType.SETEND=new Enumerator("LayerType.SETEND",1);LayerType.CONTENT=new Enumerator("LayerType.CONTENT",2);var LayerColor=this.LayerColor=function LayerColor(){};LayerColor.NONE=new Enumerator("LayerColor.NONE",c2id("None"));LayerColor.RED=new Enumerator("LayerColor.RED",c2id("Rd  "));LayerColor.ORANGE=new Enumerator("LayerColor.ORANGE",c2id("Orng"));LayerColor.YELLOW=new Enumerator("LayerColor.YELLOW",c2id("Ylw "));LayerColor.GREEN=new Enumerator("LayerColor.GREEN",c2id("Grn "));LayerColor.BLUE=new Enumerator("LayerColor.BLUE",c2id("Bl  "));LayerColor.VIOLET=new Enumerator("LayerColor.VIOLET",c2id("Vlt "));LayerColor.GRAY=new Enumerator("LayerColor.GRAY",c2id("Gry "));var LifterMaskType=this.LifterMaskType=function LifterMaskType(){};LifterMaskType.TRANSPARENCY=new Enumerator("LifterMaskType.TRANSPARENCY",0);LifterMaskType.LAYERMASK=new Enumerator("LifterMaskType.USERMASK",1);LifterMaskType.VECTORMASK=new Enumerator("LifterMaskType.VECTORMASK",2);var LifterBlendMode=this.LifterBlendMode=function LifterBlendMode(){};LifterBlendMode.PASSTHROUGH=new Enumerator("LifterBlendMode.PASSTHROUGH",s2id("passThrough"));LifterBlendMode.NORMAL=new Enumerator("LifterBlendMode.NORMAL",c2id("Nrml"));LifterBlendMode.DISSOLVE=new Enumerator("LifterBlendMode.DISSOLVE",c2id("Dslv"));LifterBlendMode.DARKEN=new Enumerator("LifterBlendMode.DARKEN",c2id("Drkn"));LifterBlendMode.MULTIPLY=new Enumerator("LifterBlendMode.MULTIPLY",c2id("Mltp"));LifterBlendMode.COLORBURN=new Enumerator("LifterBlendMode.COLORBURN",c2id("CBrn"));LifterBlendMode.LINEARBURN=new Enumerator("LifterBlendMode.LINEARBURN",s2id("linearBurn"));LifterBlendMode.DARKERCOLOR=new Enumerator("LifterBlendMode.DARKERCOLOR",s2id("darkerColor"));LifterBlendMode.LIGHTEN=new Enumerator("LifterBlendMode.LIGHTEN",c2id("Lghn"));LifterBlendMode.SCREEN=new Enumerator("LifterBlendMode.SCREEN",c2id("Scrn"));LifterBlendMode.COLORDODGE=new Enumerator("LifterBlendMode.COLORDODGE",c2id("CDdg"));LifterBlendMode.LINEARDODGE=new Enumerator("LifterBlendMode.LINEARDODGE",s2id("linearDodge"));LifterBlendMode.LIGHTERCOLOR=new Enumerator("LifterBlendMode.LIGHTERCOLOR",s2id("lighterColor"));LifterBlendMode.OVERLAY=new Enumerator("LifterBlendMode.OVERLAY",c2id("Ovrl"));LifterBlendMode.SOFTLIGHT=new Enumerator("LifterBlendMode.SOFTLIGHT",c2id("SftL"));LifterBlendMode.HARDLIGHT=new Enumerator("LifterBlendMode.HARDLIGHT",c2id("HrdL"));LifterBlendMode.VIVIDLIGHT=new Enumerator("LifterBlendMode.VIVIDLIGHT",s2id("vividLight"));LifterBlendMode.LINEARLIGHT=new Enumerator("LifterBlendMode.LINEARLIGHT",s2id("linearLight"));LifterBlendMode.PINLIGHT=new Enumerator("LifterBlendMode.PINLIGHT",s2id("pinLight"));LifterBlendMode.HARDMIX=new Enumerator("LifterBlendMode.HARDMIX",s2id("hardMix"));LifterBlendMode.DIFFERENCE=new Enumerator("LifterBlendMode.DIFFERENCE",c2id("Dfrn"));LifterBlendMode.EXCLUSION=new Enumerator("LifterBlendMode.EXCLUSION",c2id("Xclu"));LifterBlendMode.SUBTRACT=new Enumerator("LifterBlendMode.SUBTRACT",s2id("blendSubtraction"));LifterBlendMode.DIVIDE=new Enumerator("LifterBlendMode.DIVIDE",s2id("blendDivide"));LifterBlendMode.HUE=new Enumerator("LifterBlendMode.HUE",c2id("H   "));LifterBlendMode.SATURATION=new Enumerator("LifterBlendMode.SATURATION",c2id("Strt"));LifterBlendMode.COLOR=new Enumerator("LifterBlendMode.COLOR",c2id("Clr "));LifterBlendMode.LUMINOSITY=new Enumerator("LifterBlendMode.LUMINOSITY",c2id("Lmns"));LifterBlendMode.fromBlendMode=function(blendMode){return LifterBlendMode[String(blendMode).replace(/BlendMode\./,"")];};LifterBlendMode.toBlendMode=function(lifterBlendMode){return eval(lifterBlendMode.toString().replace(/LifterBlendMode/,"BlendMode"));};function _ensureLifterBlendMode(blendMode){if(blendMode instanceof Enumerator){return blendMode;}else{return LifterBlendMode.fromBlendMode(blendMode);}}var ApplyImageChannel=this.ApplyImageChannel=function ApplyImageChannel(){};ApplyImageChannel.RGB=new Enumerator("ApplyImageChannel.RGB",c2id("RGB "));ApplyImageChannel.Red=new Enumerator("ApplyImageChannel.Red",c2id("Rd  "));ApplyImageChannel.Green=new Enumerator("ApplyImageChannel.Green",c2id("Grn "));ApplyImageChannel.Blue=new Enumerator("ApplyImageChannel.Blue",c2id("Bl  "));var isDef=Lifter.isDef=function isDef(v){return(typeof v!=="undefined"&&v!==null);};var isEmpty=Lifter.isEmpty=function isEmpty(v){var empty=true;if(isDef(v)){if(isDef(v.length)){empty=(v.length===0);}else{if(Object.keys(v).length>0){empty=false;}}}return empty;};var setRuler=Lifter.setRuler=function setRuler(units){_rulerUnitCache.push(app.preferences.rulerUnits);app.preferences.rulerUnits=units;};var resetRuler=Lifter.resetRuler=function resetRuler(units){app.preferences.rulerUnits=_rulerUnitCache.pop();};var getRect=Lifter.getRect=function getRect(bounds,unit){var rect={};unit=(typeof unit==="string")?unit:"px";function _getVal(o){return(o instanceof UnitValue)?o.as(unit):o;}if(bounds instanceof LayerBounds){rect.x=bounds.left.as(unit);rect.y=bounds.top.as(unit);rect.width=bounds.right.as(unit)-rect.x;rect.height=bounds.bottom.as(unit)-rect.y;}else{rect.x=_getVal(bounds[0]);rect.y=_getVal(bounds[1]);rect.width=_getVal(bounds[2])-rect.x;rect.height=_getVal(bounds[3])-rect.y;}return rect;};function _getDescriptorProperty(desc,key,type){type||(type=desc.getType(key));switch(type){case DescValueType.ALIASTYPE:return desc.getPath(key);case DescValueType.BOOLEANTYPE:return desc.getBoolean(key);case DescValueType.CLASSTYPE:return desc.getClass(key);case DescValueType.DOUBLETYPE:return desc.getDouble(key);case DescValueType.ENUMERATEDTYPE:return{type:desc.getEnumerationType(key),value:desc.getEnumerationValue(key)};case DescValueType.INTEGERTYPE:return desc.getInteger(key);case DescValueType.LISTTYPE:return desc.getList(key);case DescValueType.OBJECTTYPE:return{type:desc.getObjectType(key),value:desc.getObjectValue(key)};case DescValueType.RAWTYPE:return desc.getData(key);case DescValueType.REFERENCETYPE:return desc.getReference(key);case DescValueType.STRINGTYPE:return desc.getString(key);case DescValueType.UNITDOUBLE:return new UnitDouble(desc.getUnitDoubleType(key),desc.getUnitDoubleValue(key));default:throw new Error(['Unsupported descriptor value type: "',type,'".'].join(""));}}Lifter.getDescPropById=_getDescPropById;function _getDescPropById(desc,tid){try{return _getDescriptorProperty(desc,tid);}catch(e){log.warn('Invalid descriptor property: "'+tid+'".'+e);return;}}Lifter.getDescPropByName=_getDescPropByName;function _getDescPropByName(desc,name){var tid,subProps;var prop=name;var dotTest=name.indexOf(".");if(dotTest!==-1){prop=name.substring(0,dotTest);subProps=name.substring(dotTest+1,name.length);desc=_getDescPropById(desc,s2id(prop)).value;return _getDescPropByName(desc,subProps);}else{return _getDescPropById(desc,s2id(prop));}}function _getWrappedActionDescriptor(desc,props,id){var fn=function(desc,props,id,name,value){if(typeof value==="undefined"){try{return _getDescriptorProperty(desc,s2id(name));}catch(e){log.warn(['Invalid layer property: "',name,'".'].join(""));return;}}else{throw new Error(['Property "',name,'" is read-only.'].join(""));}var prop=props[name];if(typeof value==="undefined"){if(prop.get){return prop.get.call(null,prop,id,desc);}else{return _getDescriptorProperty(desc,prop.typeId,prop.type);}}else{if(!prop.set){throw new Error(['Property "',name,'" is read-only.'].join(""));}prop.set.call(null,prop,id,value);}};return{innerDescriptor:desc,prop:fn.bind(null,desc,props,id)};}function _byteToPercent(value){return(value/255)*100;}function _find(collection,findType,patterns,context){function __match(id){for(var j=0;j<keysLength;j++){var matchPattern=patterns[keys[j]];var matchTarget=collection.prop(id,keys[j]);if(matchPattern instanceof RegExp){if(matchPattern.test(matchTarget)===false){return false;}}else{if(matchPattern!==matchTarget){return false;}}}found.push(id);return true;}if(typeof patterns!=="function"){if(typeof patterns!=="object"){throw new Error("Search patterns must be either a function or an object.");}var found=[],keys=Object.keys(patterns),keysLength=keys.length;switch(findType){case 2:collection.forEach(function(itemIndex,id){if(__match.call(null,id)){return true;}},null,true);return found.length?found[0]:null;case 1:collection.forEach(function(itemIndex,id){if(__match.call(null,id)){return true;}},null);return found.length?found[0]:null;default:collection.forEach(function(itemIndex,id){__match.call(null,id);},null);return found;}}else{collection.forEach(patterns,context);}}function _overloadFunction_Number_Bool(arguments,numberDefault,boolDefault){if(typeof arguments[0]==="boolean"){arguments[1]=arguments[0];arguments[0]=undefined;}arguments[0]=isNaN(arguments[0])?numberDefault:arguments[0];if(boolDefault===true){arguments[1]=(arguments[1]!==false);}else{arguments[1]=(arguments[1]===true);}}function _overloadFunction_Number_Obj(arguments,numberDefault,objDefault){if(typeof arguments[0]==="object"){arguments[1]=arguments[0];arguments[0]=undefined;}arguments[0]=isNaN(arguments[0])?numberDefault:arguments[0];if(typeof arguments[1]!=="object"&&typeof objDefault==="object"){arguments[1]=objDefault;}}function _ensureFile(myFile){if(!(myFile instanceof File)){myFile=new File(myFile);}if(!myFile.exists){throw new Error(['The specified file does not exists: "',myFile,'".'].join(""));}return myFile;}function _evalFile(myFile){try{$.evalFile(myFile);}catch(err){throw new Error(['Eval error: "',myFile,'".\n',err].join(""));}}log.log("Lifter core done.");Object.prototype.extend=Object.prototype.extend||function(){if(this===null||typeof this==="undefined"){throw new TypeError("Object.prototype.extend called on null or undefined.");}if(arguments.length===0){return this;}var sources=Array.prototype.slice.call(arguments),source,prop,i,length=sources.length;for(i=0;i<length;i++){source=sources[i];for(prop in source){if(source.hasOwnProperty(prop)){this[prop]=source[prop];}}}};Object.prototype.defaults=Object.prototype.defaults||function(){if(this===null||typeof this==="undefined"){throw new TypeError("Object.prototype.defaults called on null or undefined.");}if(arguments.length===0){return this;}var sources=Array.prototype.slice.call(arguments),source,prop,i,length=sources.length;for(i=0;i<length;i++){source=sources[i];for(prop in source){if(source.hasOwnProperty(prop)&&typeof this[prop]==="undefined"){this[prop]=source[prop];}}}};Object.prototype.clone=function(){var copy={};for(var attr in this){if(typeof this[attr]!=="object"){copy[attr]=this[attr];}else{if(this[attr]===this){copy[attr]=copy;}else{copy[attr]=this[attr].clone();}}}return copy;};Array.prototype.clone=function(){var copy=[];for(var i=0,n=this.length;i<n;i++){if(typeof this[i]!=="object"){copy[i]=this[i];}else{if(this[i]===this){copy[i]=copy;}else{copy[i]=this[i].clone();}}}return copy;};Date.prototype.clone=function(){var copy=new Date();copy.setTime(this.getTime());return copy;};Number.prototype.clone=Boolean.prototype.clone=String.prototype.clone=function(){return this;};Number.prototype.pad=function(padCount){var absNum=Math.abs(this);var zeros=Math.max(0,padCount-Math.floor(absNum).toString().length);var zeroString=Math.pow(10,zeros).toString().substr(1);if(this<0){zeroString="-"+zeroString;}return zeroString+absNum;};String.prototype.ellipsis=function ellipsis(maxLength,orientation,ellipsisString){ellipsisString=ellipsisString||"...";if(this.length>maxLength){if(maxLength>ellipsisString.length){switch(orientation){case"start":return ellipsisString+this.slice(-(maxLength-ellipsisString.length));case"center":if(maxLength!=ellipsisString.length+1){return this.slice(0,Math.floor(maxLength/2)-Math.floor(ellipsisString.length/2))+ellipsisString+this.slice(-(Math.ceil(maxLength/2)-Math.ceil(ellipsisString.length/2)),this.length);}case"end":default:return this.slice(0,maxLength-ellipsisString.length)+ellipsisString;}}else{return ellipsisString;}}return this;};(function(){var colors={};colors.arrayToSolidColor=function colorArrayToSolidColor(aRGB){var color=new SolidColor();color.rgb.red=aRGB[0];color.rgb.green=aRGB[1];color.rgb.blue=aRGB[2];return color;};colors.solidColorToArray=function colorSolidColorToArray(color){if(color.hasOwnProperty("rgb")){return[color.rgb.red,color.rgb.green,color.rgb.blue];}return[];};colors.stringToArray=function colorStringToArray(color){if(color.indexOf(",")===-1){if((color.indexOf("#")===0)){color=color.substring(1,color.length);}if(color.length===3){color=color[0]+color[0]+color[1]+color[1]+color[2]+color[2];}return[parseInt(color.substring(0,2),16),parseInt(color.substring(2,4),16),parseInt(color.substring(4,6),16)];}else{return color.replace(/[\s\(\)\[\]]/g,"").split(",");}};colors.toSolidColor=function colorToSolidColor(color){if(color instanceof SolidColor===false){if(typeof color==="string"){color=colors.toArray(color);}color=colors.arrayToSolidColor(color);}return color;};colors.toActionDescriptor=function colorToActionDescriptor(color){var aColor=colors.toArray(color);var descColor=new ActionDescriptor();var descRGBC=new ActionDescriptor();descRGBC.putDouble(c2id("Rd  "),aColor[0]);descRGBC.putDouble(c2id("Grn "),aColor[1]);descRGBC.putDouble(c2id("Bl  "),aColor[2]);descColor.putObject(s2id("color"),s2id("RGBColor"),descRGBC);return descColor;};colors.toArray=function colorToArray(color){if(typeof color!=="undefined"){switch(color.constructor.name){case"SolidColor":color=colors.solidColorToArray(color);break;case"String":color=colors.stringToArray(color);break;case"Array":color=color;break;default:color=colors.solidColorToArray(app.foregroundColor);break;}return color;}else{return colors.solidColorToArray(app.foregroundColor);}};colors.invert=function colorInvert(color){var type=color.constructor.name;color=colors.toArray(color);color=[255-color[0],255-color[1],255-color[2]];if(type==="SolidColor"){color=colors.arrayToSolidColor(color);}return color;};Lifter.colors=colors;}());(function(){log.debug("Lifter.layers loading...");var layers={};var _cache={};_cache.refresh=function _cacheRefresh(){delete _cache.hasBackground;delete _cache.layerCount;_cache.hasBackground=layers.hasBackground();_cache.layerCount=layers.count();};layers.cacheRefresh=_cache.refresh;function _wrapSwitchActive(layerId,callback,context){if(typeof layerId==="number"&&layers.prop("layerId")!==layerId){layers.stack.makeActive(layerId);}callback.call(context);}function _getMakeLayerDescriptor(name,opacity,blendMode,color){var desc=new ActionDescriptor();if(typeof name==="string"&&name.length){desc.putString(c2id("Nm  "),name);}typeof opacity==="number"||(opacity=100);desc.putUnitDouble(c2id("Opct"),c2id("#Prc"),opacity);(blendMode&&blendMode.valueOf)||(blendMode=BlendMode.NORMAL);desc.putEnumerated(c2id("Md  "),c2id("BlnM"),_ensureLifterBlendMode(blendMode).valueOf());(color&&color.valueOf)||(color=LayerColor.NONE);desc.putEnumerated(c2id("Clr "),c2id("Clr "),color.valueOf());return desc;}function _getLayerIdRef(layerId,ref){if(typeof layerId!=="number"||layerId===0){ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));}else{ref.putIdentifier(c2id("Lyr "),layerId);}}function _getItemIndexRef(itemIndex,ref){if(typeof itemIndex!=="number"){ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));}else{if(layers.count()===0){if(itemIndex!==1){throw new Error(['Could not find layer with ItemIndex "',itemIndex,'".'].join(""));}ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));}else{if(layers.hasBackground()){itemIndex--;}ref.putIndex(c2id("Lyr "),itemIndex);}}return ref;}function _getStackId(direction){if(layers.count()===0){return 0;}else{var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("LyrI"));ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),direction);return executeActionGet(ref).getInteger(c2id("LyrI"));}return layers;}function _traverseStack(direction){if(layers.count()===0){return;}layers.stack.makeActive(_getStackId(direction));return layers;}layers.ref=function(layerId,ref){ref=ref||new ActionReference();_getLayerIdRef(layerId,ref);return ref;};layers.desc=function(layerId,ref,desc){desc=desc||new ActionDescriptor();desc=executeActionGet(layers.ref(layerId,ref));return desc;};layers.toDOM=function toDom(layerId){layers.stack.makeActive(layerId);return app.activeDocument.activeLayer;};layers.supportedProperties={itemIndex:{typeId:c2id("ItmI"),type:DescValueType.INTEGERTYPE,set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set ItemIndex on background layer.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var ref2=new ActionReference();ref2.putIndex(c2id("Lyr "),value);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("T   "),ref2);desc.putBoolean(c2id("Adjs"),false);desc.putInteger(c2id("Vrsn"),5);executeAction(c2id("move"),desc,_dialogModesNo);}},layerId:{typeId:c2id("LyrI"),type:DescValueType.INTEGERTYPE,set:false},name:{typeId:c2id("Nm  "),type:DescValueType.STRINGTYPE,defaultValue:"Layer",set:function(prop,layerId,value){_wrapSwitchActive(layerId,function(){var ref=new ActionReference();ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Trgt"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putString(prop.typeId,value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);});}},color:{typeId:c2id("Clr "),type:DescValueType.ENUMERATEDTYPE,defaultValue:LayerColor.NONE,get:function(prop,layerId,desc){return Enumeration.fromValue(LayerColor,desc.getEnumerationValue(prop.typeId));},set:function(prop,layerId,value){_wrapSwitchActive(layerId,function(){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putEnumerated(c2id("Clr "),c2id("Clr "),value.valueOf());desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);});}},visible:{typeId:c2id("Vsbl"),type:DescValueType.BOOLEANTYPE,defaultValue:true,set:function(prop,layerId,value){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var list=new ActionList();list.putReference(ref);var desc=new ActionDescriptor();desc.putList(c2id("null"),list);if(value){executeAction(c2id("Shw "),desc,_dialogModesNo);}else{executeAction(c2id("Hd  "),desc,_dialogModesNo);}}},opacity:{typeId:c2id("Opct"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){var oldVisible=layers.prop(layerId,"visible");if(!oldVisible){layers.prop(layerId,"visible",true);}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);if(!oldVisible){layers.prop(layerId,"visible",false);}}},fillOpacity:{typeId:s2id("fillOpacity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Applying fill opacity to layer sets is not supported by Action Manager (nor by DOM).");}var oldVisible=layers.prop(layerId,"visible");if(!oldVisible){layers.prop(layerId,"visible",true);}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);if(!oldVisible){layers.prop(layerId,"visible",false);}}},blendMode:{typeId:c2id("Md  "),type:DescValueType.ENUMERATEDTYPE,defaultValue:BlendMode.NORMAL,get:function(prop,layerId,desc){return Enumeration.fromValue(LifterBlendMode,desc.getEnumerationValue(prop.typeId));},set:function(prop,layerId,value){value=_ensureLifterBlendMode(value).valueOf();var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putEnumerated(prop.typeId,c2id("BlnM"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},type:{typeId:s2id("layerSection"),type:DescValueType.ENUMERATEDTYPE,get:function(prop,layerId,desc){var type=typeIDToStringID(desc.getEnumerationValue(prop.typeId));switch(type){case"layerSectionStart":return LayerType.SETSTART;case"layerSectionEnd":return LayerType.SETEND;case"layerSectionContent":return LayerType.CONTENT;default:throw new Error(['Unsupported layer type encountered: "',type,'".'].join(""));}},set:false},kind:{get:function(prop,layerId,desc){if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error('Unable to get "kind" for layer sets.');}if(desc.hasKey(s2id("textKey"))){return LayerKind.TEXT;}if(desc.hasKey(s2id("smartObject"))){return LayerKind.SMARTOBJECT;}if(desc.hasKey(s2id("layer3D"))){return LayerKind.LAYER3D;}var adjustmentType=s2id("adjustment");if(desc.hasKey(adjustmentType)){var adjustmentKind=typeIDToStringID(desc.getList(adjustmentType).getClass(0));switch(adjustmentKind){case"photoFilter":return LayerKind.PHOTOFILTER;case"solidColorLayer":return LayerKind.SOLIDFILL;case"gradientMapClass":return LayerKind.GRADIENTMAP;case"gradientMapLayer":return LayerKind.GRADIENTFILL;case"hueSaturation":return LayerKind.HUESATURATION;case"colorLookup":return;case"colorBalance":return LayerKind.COLORBALANCE;case"patternLayer":return LayerKind.PATTERNFILL;case"invert":return LayerKind.INVERSION;case"posterization":return LayerKind.POSTERIZE;case"thresholdClassEvent":return LayerKind.THRESHOLD;case"blackAndWhite":return LayerKind.BLACKANDWHITE;case"selectiveColor":return LayerKind.SELECTIVECOLOR;case"vibrance":return LayerKind.VIBRANCE;case"brightnessEvent":return LayerKind.BRIGHTNESSCONTRAST;case"channelMixer":return LayerKind.CHANNELMIXER;case"curves":return LayerKind.CURVES;case"exposure":return LayerKind.EXPOSURE;default:return adjustmentKind;}}return LayerKind.NORMAL;},set:false},bounds:{typeId:s2id("bounds"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){var bounds=desc.getObjectValue(prop.typeId);return new LayerBounds(bounds.getUnitDoubleValue(c2id("Top ")),bounds.getUnitDoubleValue(c2id("Left")),bounds.getUnitDoubleValue(c2id("Btom")),bounds.getUnitDoubleValue(c2id("Rght")),bounds.getUnitDoubleType(c2id("Top ")));},set:false},boundsNoEffects:{typeId:s2id("boundsNoEffects"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){var bounds=desc.getObjectValue(prop.typeId);return new LayerBounds(bounds.getUnitDoubleValue(c2id("Top ")),bounds.getUnitDoubleValue(c2id("Left")),bounds.getUnitDoubleValue(c2id("Btom")),bounds.getUnitDoubleValue(c2id("Rght")),bounds.getUnitDoubleType(c2id("Top ")));},set:false},boundsNoMask:{typeId:s2id("boundsNoMask"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){var bounds=desc.getObjectValue(prop.typeId);return new LayerBounds(bounds.getUnitDoubleValue(c2id("Top ")),bounds.getUnitDoubleValue(c2id("Left")),bounds.getUnitDoubleValue(c2id("Btom")),bounds.getUnitDoubleValue(c2id("Rght")),bounds.getUnitDoubleType(c2id("Top ")));},set:false},group:{typeId:c2id("Grup"),type:DescValueType.BOOLEANTYPE,set:false},hasLayerMask:{typeId:s2id("hasUserMask"),type:DescValueType.BOOLEANTYPE,set:false},layerMaskEnabled:{typeId:s2id("userMaskEnabled"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask enabled: layer does not have a layer mask applied.");}return desc.getBoolean(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask enabled: layer does not have a layer mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(c2id("UsrM"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},layerMaskLinked:{typeId:s2id("userMaskLinked"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask Linked: layer does not have a layer mask applied.");}return desc.getBoolean(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask Linked: layer does not have a layer mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(c2id("Usrs"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},layerMaskDensity:{typeId:s2id("userMaskDensity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask density: layer does not have a layer mask applied.");}return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask density: layer does not have a layer mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},layerMaskFeather:{typeId:s2id("userMaskFeather"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(0,"px"),get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to get layer mask feather: layer does not have a layer mask applied.");}return desc.getUnitDoubleValue(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to set layer mask feather: layer does not have a layer mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Pxl"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},hasVectorMask:{typeId:s2id("hasVectorMask"),type:DescValueType.BOOLEANTYPE,set:false},vectorMaskEnabled:{typeId:s2id("vectorMaskEnabled"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to get layer mask enabled: layer does not have a layer mask applied.");}return desc.getBoolean(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set layer mask enabled: layer does not have a vector mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(s2id("vectorMaskEnabled"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},vectorMaskLinked:{typeId:s2id("vectorMaskLinked"),type:DescValueType.BOOLEANTYPE,defaultValue:true,get:function(prop,layerId,desc){throw new Error('Layer property "vectorMaskLinked" can only be set, never read. It simply does not exist.');},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set layer mask Linked: layer does not have a vector mask applied.");}var desc=new ActionDescriptor();var ref=layers.ref(layerId);desc.putReference(c2id("null"),ref);var descToggle=new ActionDescriptor();descToggle.putBoolean(s2id("vectorMaskLinked"),value);desc.putObject(c2id("T   "),c2id("Lyr "),descToggle);executeAction(c2id("setd"),desc,DialogModes.NO);}},vectorMaskDensity:{typeId:s2id("vectorMaskDensity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to get vector mask density: layer does not have a vector mask applied.");}return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set vector mask density: layer does not have a vector mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},vectorMaskFeather:{typeId:s2id("vectorMaskFeather"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(0,"px"),get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to get vector mask feather: layer does not have a vector mask applied.");}return desc.getUnitDoubleValue(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to set vector mask feather: layer does not have a vector mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Pxl"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},hasFilterMask:{typeId:s2id("hasFilterMask"),type:DescValueType.BOOLEANTYPE,set:false},filterMaskDensity:{typeId:s2id("filterMaskDensity"),type:DescValueType.UNITDOUBLE,defaultValue:100,get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to get filter mask density: layer does not have a filter mask applied.");}return _byteToPercent(desc.getInteger(prop.typeId));},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to set filter mask density: layer does not have a filter mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Prc"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},filterMaskFeather:{typeId:s2id("filterMaskFeather"),type:DescValueType.UNITDOUBLE,defaultValue:new UnitValue(0,"px"),get:function(prop,layerId,desc){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to get filter mask feather: layer does not have a layer mask applied.");}return desc.getUnitDoubleValue(prop.typeId);},set:function(prop,layerId,value){if(!layers.prop(layerId,"hasFilterMask")){throw new Error("Unable to set filter mask feather: layer does not have a filter mask applied.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var desc2=new ActionDescriptor();desc2.putUnitDouble(prop.typeId,c2id("#Pxl"),value);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},allLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectAll"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){if(value){throw new Error("Unable to set lock on background layer.");}else{_wrapSwitchActive(layerId,layers.makeLayerFromBackground);}}else{_wrapSwitchActive(layerId,function(){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectAll"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);});}}},pixelsLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectComposite"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set pixels lock on background layer.");}if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Pixels lock can not be set on layer sets.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectComposite"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},positionLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectPosition"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set position lock on background layer.");}if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Position lock can not be set on layer sets.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectPosition"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},transparentPixelsLocked:{typeId:s2id("layerLocking"),type:DescValueType.BOOLEANTYPE,defaultValue:false,get:function(prop,layerId,desc){return desc.getObjectValue(prop.typeId).getBoolean(s2id("protectTransparency"));},set:function(prop,layerId,value){if(layers.prop(layerId,"isBackgroundLayer")){throw new Error("Unable to set transparency lock on background layer.");}if(layers.prop(layerId,"type")!==LayerType.CONTENT){throw new Error("Transparency lock can not be set on layer sets.");}var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var lock=new ActionDescriptor();lock.putBoolean(s2id("protectTransparency"),value);var desc2=new ActionDescriptor();desc2.putObject(prop.typeId,prop.typeId,lock);desc.putObject(c2id("T   "),c2id("Lyr "),desc2);executeAction(c2id("setd"),desc,_dialogModesNo);}},isBackgroundLayer:{typeId:c2id("Bckg"),type:DescValueType.BOOLEANTYPE,get:function(prop,layerId,desc){return layerId===0||desc.getBoolean(prop.typeId);},set:false},xmpMetadata:{typeId:s2id("metadata"),type:DescValueType.OBJECTTYPE,set:false},lastModified:{typeId:s2id("metadata"),type:DescValueType.DOUBLETYPE,get:function(prop,layerId,desc){var lastModified=new Date();lastModified.setTime(desc.getObjectValue(prop.typeId).getDouble(s2id("layerTime"))*1000);return lastModified;},set:false},smartObject:{typeId:s2id("smartObject"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return desc.getObjectValue(prop.typeId);}},set:false},smartObjectMore:{typeId:s2id("smartObjectMore"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return desc.getObjectValue(prop.typeId);}},set:false},"smartObject.link":{typeId:s2id("smartObject"),type:DescValueType.ALIASTYPE,get:function(prop,layerId,desc){if(!desc.hasKey(prop.typeId)){return;}var soDesc=layers.prop(layerId,"smartObject");if(soDesc&&soDesc.hasKey(s2id("link"))&&soDesc.getType(s2id("link"))==prop.type){return String(soDesc.getPath(s2id("link")));}},set:function(prop,layerId,value){try{var desc=new ActionDescriptor();desc.putPath(c2id("null"),_ensureFile(value));executeAction(s2id("placedLayerRelinkToFile"),desc,DialogModes.NO);}catch(e){throw new Error("Can not relink smart object..."+e.message);}}},"smartObject.compsList":{typeId:s2id("smartObject"),type:DescValueType.OBJECTTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){var compsDesc=layers.prop(layerId,"smartObject").getObjectValue(s2id("compsList"));if(compsDesc&&compsDesc.hasKey(s2id("compList"))){var compList=compsDesc.getList(s2id("compList"));var compObj={};for(var c=compList.count-1;c>=0;c--){var compObjDesc=compList.getObjectValue(c);var compObjID=compObjDesc.getInteger(s2id("ID"));compObj[compObjID]=compObjDesc.getString(s2id("name"));}return compObj;}}},set:false},"smartObjectMore.comp":{typeId:s2id("smartObjectMore"),type:DescValueType.INTEGERTYPE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return layers.prop(layerId,"smartObjectMore").getInteger(s2id("comp"));}},set:function(prop,layerId,value){try{value=(typeof value==="number"&&value>=0)?value:-1;var ref=layers.ref(layerId);if(executeActionGet(ref).hasKey(prop.typeId)){var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putInteger(s2id("compID"),value);executeAction(s2id("setPlacedLayerComp"),desc,DialogModes.NO);}}catch(e){throw new Error("Can not set comp on smart object..."+e.message);}}},"smartObjectMore.resolution":{typeId:s2id("smartObjectMore"),type:DescValueType.UNITDOUBLE,get:function(prop,layerId,desc){if(desc.hasKey(prop.typeId)){return layers.prop(layerId,"smartObjectMore").getDouble(s2id("resolution"));}},set:false}};layers.count=function(){if(_cache.hasOwnProperty("layerCount")){return _cache.layerCount;}var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("NmbL"));ref.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));var count=executeActionGet(ref).getInteger(c2id("NmbL"));if(count>0){if(_cache.hasOwnProperty("hasBackground")){if(_cache.hasBackground){count++;}}else{ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("Bckg"));ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Back"));if(executeActionGet(ref).getBoolean(c2id("Bckg"))){count++;}}}return count;};layers.getLayerIdByItemIndex=function(itemIndex){var ref=new ActionReference();ref.putProperty(c2id("Prpr"),c2id("LyrI"));_getItemIndexRef(itemIndex,ref);return executeActionGet(ref).getInteger(c2id("LyrI"));};layers.hasBackground=function(){if(_cache.hasOwnProperty("hasBackground")){return _cache.hasBackground;}if(Lifter.layers.count()===0){return true;}else{var ref=new ActionReference();ref.putProperty(c2id("Prpr"),s2id("hasBackgroundLayer"));ref.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));var desc=executeActionGet(ref);var res=desc.getBoolean(s2id("hasBackgroundLayer"));return res;}};layers.add=function(name,opacity,blendMode,color){var ref=new ActionReference();ref.putClass(c2id("Lyr "));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putObject(c2id("Usng"),c2id("Lyr "),_getMakeLayerDescriptor(name,opacity,blendMode,color));executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.addLayerSet=function(name,opacity,blendMode,color){var ref=new ActionReference();ref.putClass(s2id("layerSection"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putObject(c2id("Usng"),s2id("layerSection"),_getMakeLayerDescriptor(name,opacity,blendMode,color));executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.remove=function(layerId){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);executeAction(c2id("Dlt "),desc,_dialogModesNo);return layers;};layers.makeLayerFromBackground=function(name,opacity,blendMode,color){if(!Lifter.layers.hasBackground()){return;}var ref=new ActionReference();ref.putProperty(c2id("Lyr "),c2id("Bckg"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putObject(c2id("T   "),c2id("Lyr "),_getMakeLayerDescriptor(name,opacity,blendMode,color));executeAction(c2id("setd"),desc,_dialogModesNo);return layers;};layers.duplicate=function(layerId,documentId){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);if(documentId){var ref2=new ActionReference();ref.putIdentifier(c2id("Dcmn"),documentId);desc.putReference(c2id("T   "),ref2);}desc.putInteger(c2id("Vrsn"),5);executeAction(c2id("Dplc"),desc,_dialogModesNo);return layers;};layers.applyImage=function(sourceDocumentId,sourceLayerId,sourceChannel,invert,blendMode,opacity,preserveTransparency){if(!Lifter.documents){throw new Error("Lifter.layers.applyImage requires the Lifter.documents library.");}if(typeof sourceDocumentId!=="number"){sourceDocumentId=Lifter.documents.getActiveDocumentId();}if(sourceLayerId!=="merged"&&typeof sourceLayerId!=="number"){sourceLayerId=layers.stack.getActiveLayerId();}if(sourceChannel){if(!Enumeration.contains(ApplyImageChannel,sourceChannel)){throw new TypeError("Invalid sourceChannel:"+sourceChannel);}}else{sourceChannel=ApplyImageChannel.RGB;}typeof invert==="boolean"||(invert=false);(blendMode&&blendMode.valueOf)||(blendMode=LifterBlendMode.NORMAL);blendMode=_ensureLifterBlendMode(blendMode);typeof opacity==="number"||(opacity=100);typeof preserveTransparency==="boolean"||(preserveTransparency=true);var ref=new ActionReference();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),sourceChannel.valueOf());if(sourceLayerId==="merged"){ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),c2id("Mrgd"));}else{var activeDocId=Lifter.documents.getActiveDocumentId();Lifter.documents.makeActive(sourceDocId);if(layers.prop("isBackgroundLayer")){ref.putProperty(c2id("Lyr "),c2id("Bckg"));}else{ref.putIdentifier(c2id("Lyr "),sourceLayerId);}Lifter.documents.makeActive(activeDocId);}ref.putIdentifier(c2id("Dcmn"),sourceDocumentId);var desc2=new ActionDescriptor();desc2.putReference(c2id("T   "),ref);desc2.putEnumerated(c2id("Clcl"),c2id("Clcn"),blendMode.valueOf());desc2.putUnitDouble(c2id("Opct"),c2id("#Prc"),opacity);desc2.putBoolean(c2id("PrsT"),preserveTransparency);desc2.putBoolean(c2id("Invr"),invert);var desc=new ActionDescriptor();desc.putObject(c2id("With"),c2id("Clcl"),desc2);executeAction(c2id("AppI"),desc,_dialogModesNo);return layers;};layers.invert=function(layerId){if(typeof layerId==="number"){layers.stack.makeActive(layerId);}executeAction(c2id("Invr"),undefined,_dialogModesNo);return layers;};layers.fill=function(layerId,fillColor,blendMode,opacity){if(typeof layerId==="number"){layers.stack.makeActive(layerId);}(fillColor)||(fillColor=app.backgroundColor);if(!(fillColor instanceof SolidColor)){throw new Error("Fill color must be a valid SolidColor: "+fillColor);}(blendMode&&blendMode.valueOf)||(blendMode=LifterBlendMode.NORMAL);blendMode=_ensureLifterBlendMode(blendMode);typeof opacity==="number"||(opacity=100);var desc=new ActionDescriptor();desc.putEnumerated(c2id("Usng"),c2id("FlCn"),c2id("Clr "));var desc2=new ActionDescriptor();desc2.putUnitDouble(c2id("H   "),c2id("#Ang"),fillColor.hsb.hue);desc2.putDouble(c2id("Strt"),fillColor.hsb.saturation);desc2.putDouble(c2id("Brgh"),fillColor.hsb.brightness);desc.putObject(c2id("Clr "),c2id("HSBC"),desc2);desc.putUnitDouble(c2id("Opct"),c2id("#Prc"),opacity);desc.putEnumerated(c2id("Md  "),c2id("BlnM"),blendMode.valueOf());executeAction(c2id("Fl  "),desc,_dialogModesNo);return layers;};layers.forEach=function(callback,context,reverse){if(typeof callback!=="function"){throw new Error("Callback must be a valid function.");}var n,i;_cache.refresh();if(reverse){i=_cache.layerCount+1;n=0;while(--i>n){if(callback.call(context,i,layers.getLayerIdByItemIndex(i))){break;}}}else{n=_cache.layerCount+1;i=0;while(++i<n){if(callback.call(context,i,layers.getLayerIdByItemIndex(i))){break;}}}_cache.refresh();return layers;};layers.forEachSelected=layers.forEachActive=function(callback,context,reverse){if(typeof callback!=="function"){throw new Error("Callback must be a valid function.");}var n,i;var activeLayerIds=layers.stack.getActiveLayerIds();if(reverse){i=activeLayerIds.length;n=0;while(--i>=n){if(callback.call(context,i,activeLayerIds[i])){break;}}}else{n=activeLayerIds.length;i=0;while(i<n){if(callback.call(context,i,activeLayerIds[i])){break;}i++;}}return layers;};layers.forEachId=function(layerIds,callback,context,reverse){if(typeof callback!=="function"){throw new Error("Callback must be a valid function.");}var n,i;if(reverse){i=layerIds.length;n=0;while(--i>=n){if(callback.call(context,i,layerIds[i])){break;}}}else{n=layerIds.length;i=0;while(i<n){if(callback.call(context,i,layerIds[i])){break;}i++;}}return layers;};layers.prop=function(){var layerId,name,value,ref,desc;if(typeof arguments[0]==="number"||(!arguments[0]&&arguments.length>1)){layerId=arguments[0];name=arguments[1];value=arguments[2];}else{name=arguments[0];value=arguments[1];}if(typeof name==="undefined"){ref=new ActionReference();_getLayerIdRef(layerId,ref);desc=executeActionGet(ref);return _getWrappedActionDescriptor(desc,layers.supportedProperties,layerId||desc.getInteger(c2id("LyrI")));}else{if(!layers.supportedProperties.hasOwnProperty(name)){if(typeof value==="undefined"){try{return _getDescPropByName(layers.desc(layerId),name);}catch(e){log.warn(['Invalid layer property: "',name,'".'].join(""));return;}}else{throw new Error(['Setting property "',name,'" is not supported by Lifter.'].join(""));}}var prop=layers.supportedProperties[name];if(typeof value==="undefined"){ref=new ActionReference();if(prop.typeId){ref.putProperty(c2id("Prpr"),prop.typeId);}_getLayerIdRef(layerId,ref);try{desc=executeActionGet(ref);}catch(e){throw new Error("Unable to find "+typeIDToStringID(prop.typeId)+' on "'+layers.prop(layerId,"name")+'": layers do not have that property or it is un-gettable.');}if(prop.get){return prop.get.call(null,prop,layerId,desc);}else{return _getDescriptorProperty(desc,prop.typeId,prop.type);}}else{if(!prop.set){throw new Error(['Property "',name,'" is read-only.'].join(""));}if(layers.prop(layerId,"type")===LayerType.SETEND){throw new Error(["Setting properties on a layer of type ",LayerType.SETEND.toString()," is not supported."].join(""));}prop.set.call(null,prop,layerId,value);return layers;}}};layers.findAllByName=function(search){var regex=(typeof search==="string")?new RegExp("^"+search+"$"):new RegExp(search);var matchIDs=[];layers.forEach(function(itemIndex,layerId){if(layers.prop(layerId,"name").search(regex)!==-1){matchIDs.push(layerId);}});return matchIDs;};layers.findAll=_find.bind(null,layers,0);layers.findFirst=_find.bind(null,layers,1);layers.findLast=_find.bind(null,layers,2);layers.getParentIds=function(inLayerId,doAll){var n;var i;var layerId;var parentIds=[];var depth=1;if(typeof inLayerId==="boolean"){doAll=inLayerId;}if(typeof inLayerId!=="number"){inLayerId=layers.prop("layerId");}_cache.refresh();n=_cache.layerCount+1;i=layers.prop(inLayerId,"itemIndex");while(++i<n){layerId=layers.getLayerIdByItemIndex(i);if(layers.prop(layerId,"type")==LayerType.SETSTART){if(depth>0){parentIds.push(layerId);if(doAll){depth=0;}else{break;}}depth++;}else{if(layers.prop(layerId,"type")==LayerType.SETEND){depth--;}}}return parentIds;};layers.getChildIds=function(layerSetId,doAll){var i;var n;var layerId;var depth=1;var childIDs=[];if(typeof layerSetId==="boolean"){doAll=layerSetId;}if(typeof layerSetId!=="number"){layerSetId=layers.prop("layerId");}if(!layers.isGroup(layerSetId)){throw new TypeError("getChildIds() - "+layers.prop(layerSetId,"name")+" is not a layer set.");}_cache.refresh();i=layers.prop(layerSetId,"itemIndex");n=0;while(--i>n&&depth>0){layerId=layers.getLayerIdByItemIndex(i);if(layers.prop(layerId,"type")==LayerType.SETSTART){if(depth==1||doAll){childIDs.push(layerId);}depth++;}else{if(layers.prop(layerId,"type")==LayerType.SETEND){depth--;if(depth<1){break;}}else{if(depth==1||doAll){childIDs.push(layerId);}}}}return childIDs;};layers.getAllLayerIds=function(){var allIDs=[];layers.forEach(function(itemIndex,layerId){allIDs.push(layerId);});return allIDs;};layers.getAllActiveLayerIds=function(){var activeLayerIds=[];var docRef=new ActionReference();docRef.putEnumerated(c2id("Dcmn"),c2id("Ordn"),c2id("Trgt"));var docDesc=executeActionGet(docRef);if(docDesc.hasKey(s2id("targetLayersIDs"))){targetLayersIDsDesc=docDesc.getList(s2id("targetLayersIDs"));for(var ii=0;ii<targetLayersIDsDesc.count;ii++){activeLayerIds.push(Number(targetLayersIDsDesc.getReference(ii).getIdentifier()));}}return activeLayerIds;};layers.stack={};layers.stack.getActiveLayerIds=layers.getAllActiveLayerIds;_stackCache={};layers.stack.saveIdList=function(cacheId,layerIds){if(typeof cacheId!=="number"){cacheId=0;}if(typeof layerIds!=="object"){layerIds=layers.getAllLayerIds();}_stackCache[cacheId]=[].concat(layerIds);return layers;};layers.stack.saveActiveIds=function(cacheId){if(typeof cacheId!=="number"){cacheId=0;}layers.stack.saveIdList(cacheId,layers.getAllActiveLayerIds());return layers;};layers.stack.getIdList=function(cacheId){if(typeof cacheId!=="number"){cacheId=0;}return _stackCache[cacheId];};layers.stack.restoreIdList=function(cacheId){if(typeof cacheId!=="number"){cacheId=0;}layers.stack.makeActive(layers.stack.getIdList(cacheId));delete _stackCache[cacheId];return layers;};layers.stack.getActiveLayerId=function(){return layers.prop("layerId");};layers.stack.getFrontLayerId=_getStackId.bind(null,c2id("Frnt"));layers.stack.getBottomLayerId=_getStackId.bind(null,c2id("Back"));layers.stack.getNextLayerId=_getStackId.bind(null,c2id("Frwr"));layers.stack.getPreviousLayerId=_getStackId.bind(null,c2id("Bckw"));layers.stack.getNextSiblingLayerId=function stackGetNextSiblingLayerId(layerId){var i=layers.prop(layerId,"itemIndex");var newIndex=i-1;var lastIndex=(layers.hasBackground())?0:1;var depth=1;var targetId;_cache.refresh();if(layers.isGroup(layerId)){while(--i>0&&depth>0){targetId=layers.getLayerIdByItemIndex(i);if(layers.prop(targetId,"type")==LayerType.SETSTART){depth++;}else{if(layers.prop(targetId,"type")==LayerType.SETEND){depth--;if(depth<1){newIndex=i-1;break;}}}}}if(newIndex>=lastIndex){targetId=layers.getLayerIdByItemIndex(newIndex);if(layers.prop(targetId,"type")!==LayerType.SETEND){return targetId;}}return -1;};layers.stack.getPreviousSiblingLayerId=function stackGetPreviousSiblingLayerId(layerId){var newIndex=layers.prop(layerId,"itemIndex")+1;var targetId;_cache.refresh();if(newIndex>layers.count()){return -1;}targetId=layers.getLayerIdByItemIndex(newIndex);if(layers.isGroup(targetId)){return -1;}else{if(layers.prop(targetId,"type")===LayerType.SETEND){newIndex++;targetId=layers.getLayerIdByItemIndex(newIndex);if(layers.isGroup(targetId)){targetId=layers.getParentIds(targetId)[0];}}}return targetId;};layers.stack.makeActive=function(layerIdList,makeVisible,add){if(add!==true){layers.stack.makeNoneActive();}layerIdList=[].concat(layerIdList);for(i=0;i<layerIdList.length;i++){layerId=layerIdList[i];if(typeof layerId!=="number"||layerId<1){throw new Error("Invalid layerId: "+layerId);}makeVisible===true||(makeVisible=false);var ref=new ActionReference();ref.putIdentifier(c2id("Lyr "),layerId);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putBoolean(c2id("MkVs"),makeVisible);desc.putEnumerated(s2id("selectionModifier"),s2id("selectionModifierType"),s2id("addToSelection"));executeAction(c2id("slct"),desc,_dialogModesNo);}return layers;};layers.stack.makeAllActive=function(){layers.stack.makeActive(layers.getAllLayerIds());};layers.stack.makeFrontActive=_traverseStack.bind(null,c2id("Frnt"));layers.stack.makeBottomActive=_traverseStack.bind(null,c2id("Back"));layers.stack.makeNextActive=_traverseStack.bind(null,c2id("Frwr"));layers.stack.makePreviousActive=_traverseStack.bind(null,c2id("Bckw"));layers.stack.makeNoneActive=function(){var desc=new ActionDescriptor();var ref=new ActionReference();ref.putEnumerated(c2id("Lyr "),c2id("Ordn"),s2id("targetEnum"));desc.putReference(c2id("null"),ref);executeAction(s2id("selectNoLayers"),desc,_dialogModesNo);return layers;};layers.groups={};layers.groups.isGroup=function(layerId){return layers.prop(layerId,"type")==LayerType.SETSTART;};layers.isGroup=layers.groups.isGroup;layers.groups.getEndIndex=function groupsGetBottomIndex(groupId){var i;var n;var layerId;var depth=1;if(typeof groupId!=="number"){groupId=layers.prop("layerId");}if(layers.isGroup(groupId)===false){throw new Error('"'+layers.prop(groupId,"name")+'" is not a layer set (group).');}_cache.refresh();i=layers.prop(groupId,"itemIndex");n=0;while(--i>n&&depth>0){layerId=layers.getLayerIdByItemIndex(i);if(layers.prop(layerId,"type")==LayerType.SETSTART){depth++;}else{if(layers.prop(layerId,"type")==LayerType.SETEND){depth--;if(depth<1){break;}}}}var name=layers.prop(layerId,"name");var isGroup=layers.isGroup(layerId);var prevId=layers.getLayerIdByItemIndex(i+1);var prevName=layers.prop(prevId,"name");return i;};layers.groups.make=function(name,addLayers,layerIds,color){var idLyr=s2id("layer");var idOrdn=c2id("Ordn");var idTrgt=s2id("targetEnum");var idnull=c2id("null");var refLyr;var descMake=new ActionDescriptor();var refClass=new ActionReference();refClass.putClass(s2id("layerSection"));descMake.putReference(idnull,refClass);if(typeof layerIds==="number"){layerIds=[layerIds];}if(addLayers){if(Array.isArray(layerIds)){layers.stack.makeActive(layerIds);}refLyr=new ActionReference();refLyr.putEnumerated(idLyr,idOrdn,idTrgt);descMake.putReference(c2id("From"),refLyr);}executeAction(s2id("make"),descMake,DialogModes.NO);if(name!==undefined&&name.length){var descSet=new ActionDescriptor();refLyr=new ActionReference();refLyr.putEnumerated(idLyr,idOrdn,idTrgt);descSet.putReference(idnull,refLyr);var descName=new ActionDescriptor();descName.putString(s2id("name"),name);descSet.putObject(s2id("to"),idLyr,descName);executeAction(s2id("set"),descSet,DialogModes.NO);}_cache.refresh();return layers.prop("layerId");};layers.groups.merge=function(layerId){layers.stack.makeActive(layerId);executeAction(c2id("Mrg2"),undefined,DialogModes.NO);_cache.refresh();return layers;};layers.groups.prepend=function groupsPrepend(groupId,layerIds,ignoreHeirarchy){if(layers.isGroup(groupId)===false){throw new Error('"'+layers.prop(groupId,"name")+'" is not a layer set (group).');}layers.stack.makeActive(groupId);layers.move(layerIds,groupId,ElementPlacement.PLACEATBEGINNING,ignoreHeirarchy);return layers;};layers.groups.append=function groupsAppend(groupId,layerIds,ignoreHeirarchy){if(layers.isGroup(groupId)===false){throw new Error('"'+layers.prop(groupId,"name")+'" is not a layer set (group).');}layers.stack.makeActive(groupId);layers.move(layerIds,groupId,ElementPlacement.PLACEATEND,ignoreHeirarchy);return layers;};layers.moveBefore=function moveBefore(layerIds,targetId,ignoreHeirarchy){layers.stack.makeActive(targetId);layers.move(layerIds,targetId,ElementPlacement.PLACEBEFORE,ignoreHeirarchy);return layers;};layers.moveAfter=function moveAfter(layerIds,targetId,ignoreHeirarchy){layers.stack.makeActive(targetId);layers.move(layerIds,targetId,ElementPlacement.PLACEAFTER,ignoreHeirarchy);return layers;};layers.move=function move(layerIds,targetId,placement,indexOffset,ignoreHeirarchy){var targetIndex=layers.prop(targetId,"itemIndex");var newIndex;var moveIds;var i;var iCount;var layerId;var layerIndex;var children;var lastChildId;var lastChildIndex;var groupEndIndex;var targetDOM=layers.toDOM(targetId);var layerDOM;var tmpLayerDOM;var tmpLayerIndex;function _idFilter(id){return !children.includes(id);}indexOffset=(typeof indexOffset==="number")?indexOffset:0;placement=(isDef(placement))?placement:ElementPlacement.PLACEBEFORE;if(typeof targetId!=="number"){throw new Error("No invalid target index "+targetIndex+" .");}if(typeof layerIds==="number"){layerIds=[layerIds];}else{if(!L.isDef(layerIds)){layerIds=layers.stack.getActiveLayerIds();}}iCount=layerIds.length;moveIds=layerIds;newIndex=targetIndex+indexOffset;for(i=0;i<iCount;i++){layerId=layerIds[i];layerIndex=layers.prop(layerId,"itemIndex");if(moveIds.includes(layerId)===false){continue;}if(layers.isGroup(layerId)){groupEndIndex=layers.groups.getEndIndex(layerId);if(newIndex<layerIndex&&newIndex>=groupEndIndex){throw new Error('"'+layers.prop(layerId,"name")+'" can not be moved inside "'+layers.prop(targetId,"name")+'".');}if(ignoreHeirarchy!==true){children=layers.getChildIds(layerId,true);moveIds=moveIds.filter(_idFilter);}}}iCount=moveIds.length;for(i=0;i<iCount;i++){layerId=moveIds[0];log.log("Moving "+layers.prop(layerId,"name"));newIndex=layers.prop(targetId,"itemIndex")+indexOffset;switch(placement){case ElementPlacement.PLACEAFTER:if(layers.isGroup(targetId)){newIndex=layers.groups.getEndIndex(targetId)-1;}else{newIndex--;}break;case ElementPlacement.PLACEATEND:children=layers.getChildIds(targetId);if(children.length){layers.stack.makeActive(targetId);lastChildId=children[children.length-1];lastChildIndex=layers.prop(lastChildId,"itemIndex");tmpLayerId=layers.add().prop("layerId");layers.prop(tmpLayerId,"itemIndex",lastChildIndex);tmpLayerIndex=layers.prop(tmpLayerId,"itemIndex");layers.prop(lastChildId,"itemIndex",tmpLayerIndex);tmpLayerIndex=layers.prop(tmpLayerId,"itemIndex");newIndex=tmpLayerIndex-1;layers.remove(tmpLayerId);}else{newIndex--;}break;case ElementPlacement.INSIDE:case ElementPlacement.PLACEATBEGINNING:newIndex--;break;case ElementPlacement.PLACEBEFORE:default:break;}try{layers.prop(layerId,"itemIndex",newIndex);}catch(e){throw new Error('There was a problem moving "'+layers.prop(layerId,"name")+'" from index '+layers.prop(layerId,"itemIndex")+" to "+newIndex);}}return layers;};layers.smartObjects={};function _ensureSmartObjectIsActive(layerId){if(typeof layerId==="number"){layers.stack.makeActive(layerId);}if(layers.prop("kind")!==LayerKind.SMARTOBJECT){throw new Error("Layer "+layers.prop(null,"name")+" must be a smart object.");}}layers.smartObjects.isEmbedded=function isEmbedded(layerId){var soDesc=layers.prop(layerId,"smartObject");return(soDesc&&soDesc.getBoolean(s2id("linked"))===false);};layers.smartObjects.isLinked=function isLinked(layerId){var soDesc=layers.prop(layerId,"smartObject");return(soDesc&&soDesc.hasKey(s2id("link"))&&soDesc.getType(s2id("link"))==DescValueType.ALIASTYPE);};layers.smartObjects.isCloudFile=function isCloudFile(layerId){var soDesc=layers.prop(layerId,"smartObject");var isCloudFile=(soDesc&&soDesc.hasKey(s2id("link"))&&soDesc.getType(s2id("link"))==DescValueType.OBJECTTYPE);return isCloudFile;};layers.smartObjects.getCloudFilePath=function getCloudFilePath(layerId){var soDesc=layers.prop(layerId,"smartObject");var str;var lookUpFile=new File(Folder.userData+"/Adobe/Creative Cloud Libraries/LIBS/librarylookupfile");if(soDesc.getBoolean(s2id("linkMissing"))){throw new Error("Link missing in Cloud assest. Bad permissions or deteted library.");}if(!lookUpFile.exists){throw new Error("Lookup reference file for cloud assests not found.");}lookUpFile.open("r");str=lookUpFile.read();lookUpFile.close();var assetUrl=soDesc.getObjectValue(stringIDToTypeID("link")).getString(stringIDToTypeID("elementReference"));var refKeys=assetUrl.split("/adobe-libraries/")[1].split(";node=");var lookUpObj=eval("("+str+")");var pathToSo=lookUpObj.libraries[refKeys[0]].elements[refKeys[1]].reps[0].path;if(!pathToSo){throw new Error("Cached cloud file not found in "+pathToSo);}return pathToSo;};layers.smartObjects.make=function(layerId,isLink,imageFile){_ensureSmartObjectIsActive(layerId);executeAction(s2id("newPlacedLayer"),undefined,_dialogModesNo);if(isLink){layers.smartObjects.convertToLinked(null,imageFile);}return layers;};layers.smartObjects.makeCopy=function(layerId,newName,skipPrompt){_ensureSmartObjectIsActive(layerId);var srcLinkPath=layers.prop("smartObject.link");if(srcLinkPath){var srcFile=new File(srcLinkPath);var searchIdx=srcFile.name.lastIndexOf(".");var srcLinkExtension=srcFile.name.slice(searchIdx,srcFile.name.length);var srcLinkNameNumber;var newLinkFile;if(!newName){newName=srcFile.name.slice(0,searchIdx);srcLinkNameNumber=newName.match(/\d*$/)[0];if(srcLinkNameNumber.length){newName=newName.substr(0,newName.length-srcLinkNameNumber.length);newName+=Number(Number(srcLinkNameNumber)+1).pad(srcLinkNameNumber.length);}else{newName+="_02";}if(!skipPrompt){newName=prompt("Enter a name for the new file to be linked...",newName,"New File Name");if(typeof newName!=="string"){return;}}}newName=newName;if(newName.search(srcLinkExtension)===-1){newName+=srcLinkExtension;}newLinkFile=new File(srcFile.parent+"/"+newName);if(newLinkFile.absoluteURI===srcFile.absoluteURI){alert("But... that's the same file... "+newName,"Nooooooo!");return;}newLinkFile=Lifter.system.files.copy(srcFile,newLinkFile)[0];if(typeof newLinkFile==="undefined"){return;}if(!newLinkFile.exists){log.error("Error copying file. No file found at destination: "+newLinkFile.name);return;}var soMoreDesc=layers.prop("smartObjectMore");var compAppliedID=soMoreDesc.getInteger(s2id("comp"));var sizeKeyDesc=soMoreDesc.getObjectValue(c2id("Sz  "));var soWidthInner=sizeKeyDesc.getDouble(s2id("width"));var soHeightInner=sizeKeyDesc.getDouble(s2id("height"));var soVertList=soMoreDesc.getList(s2id("nonAffineTransform"));var soX=soVertList.getDouble(0);var soY=soVertList.getDouble(1);var soWidthPlaced=soVertList.getDouble(2)-soVertList.getDouble(0);var soHeightPlaced=soVertList.getDouble(5)-soVertList.getDouble(1);var soDPIRatio=soMoreDesc.getDouble(s2id("resolution"))/app.activeDocument.resolution;var soScaleX=(soWidthPlaced/soWidthInner)*soDPIRatio;var soScaleY=(soHeightPlaced/soHeightInner)*soDPIRatio;layers.smartObjects.place(newLinkFile,true,soX,soY,soScaleX*100,soScaleY*100);layers.smartObjects.setComp(null,compAppliedID);}else{executeAction(s2id("placedLayerMakeCopy"),undefined,_dialogModesNo);if(typeof newName==="string"){layers.prop("name",newName);}}return layers;};layers.smartObjects.edit=function(layerId){_ensureSmartObjectIsActive(layerId);var desc=new ActionDescriptor();executeAction(s2id("placedLayerEditContents"),desc,DialogModes.NO);var activeDocId=Lifter.documents.getActiveDocumentId();Lifter.documents.makeActive(activeDocId);_cache.refresh();return layers;};layers.smartObjects.place=function(imageFile,isLink,posX,posY,scaleX,scaleY){scaleX=(scaleX!==undefined)?scaleX:100;scaleY=(scaleY!==undefined)?scaleY:100;if(!imageFile){imageFile=File.openDialog();if(!imageFile){throw new ERROR("User aborted convert to linked object...");}}try{var descPlace=new ActionDescriptor();var idPrc=c2id("#Prc");descPlace.putPath(c2id("null"),_ensureFile(imageFile));descPlace.putEnumerated(c2id("FTcs"),c2id("QCSt"),c2id("Qcsa"));descPlace.putUnitDouble(c2id("Wdth"),c2id("#Prc"),scaleX);descPlace.putUnitDouble(c2id("Hght"),c2id("#Prc"),scaleY);if(isLink){descPlace.putBoolean(c2id("Lnkd"),true);}executeAction(c2id("Plc "),descPlace,DialogModes.NO);var newLinkedLayer=app.activeDocument.activeLayer;var soMoreDesc=layers.prop("smartObjectMore");var soVertList=soMoreDesc.getList(s2id("nonAffineTransform"));var soX=soVertList.getDouble(0);var soY=soVertList.getDouble(1);if(typeof posX=="number"&&typeof posY=="number"){newLinkedLayer.translate(-(soX-posX)+" px",-(soY-posY)+" px");}}catch(e){throw new Error("Can not place new smart object..."+e.message);}return layers;};layers.smartObjects.convertToLinked=function(layerId,imageFile){if(layers.prop("kind")!==LayerKind.SMARTOBJECT){layers.smartObjects.make(layerId,true,imageFile);}else{if(!imageFile){imageFile=File.openDialog();if(!imageFile){throw new ERROR("User aborted convert to linked object...");}}try{var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putPath(c2id("Usng"),_ensureFile(imageFile));executeAction(s2id("placedLayerConvertToLinked"),desc,DialogModes.NO);}catch(e){throw new Error("Can not convert to linked object..."+e.message);}}return layers;};layers.smartObjects.reLinkToFile=function(layerId,imageFile){if(layers.prop("kind")!==LayerKind.SMARTOBJECT){layers.smartObjects.make(layerId,true,imageFile);}else{if(!imageFile){imageFile=File.openDialog();if(!imageFile){throw new ERROR("User aborted convert to linked object...");}}try{var ref=new ActionReference();_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putPath(c2id("Usng"),_ensureFile(imageFile));executeAction(s2id("placedLayerConvertToLinked"),desc,DialogModes.NO);}catch(e){throw new Error("Can not convert to linked object..."+e.message);}}return layers;};layers.smartObjects.convertToEmbedded=function(layerId){if(layers.prop(layerId,"kind")===LayerKind.SMARTOBJECT&&layers.prop(layerId,"smartObject.link")){try{_ensureSmartObjectIsActive(layerId);executeAction(s2id("placedLayerConvertToEmbedded"),undefined,_dialogModesNo);}catch(e){throw new Error("Can not convert to embedded object..."+e.message);}}return layers;};layers.smartObjects.setComp=function(layerId,compID){var cacheId=new Date().getMilliseconds();layers.stack.saveActiveIds(cacheId);layers.prop(layerId,"smartObjectMore.comp",compID);layers.stack.restoreIdList(cacheId);return layers;};layers.masks={};layers.masks.hasMask=function(layerId){return(layers.prop(layerId,"hasUserMask")||layers.prop(layerId,"hasVectorMask"));};layers.masks.hasLayerMask=function(layerId){return layers.prop(layerId,"hasUserMask");};layers.masks.hasVectorMask=function(layerId){return layers.prop(layerId,"hasVectorMask");};layers.masks.hasFilterMask=function(layerId){return layers.prop(layerId,"hasFilterMask");};layers.masks.addLayerMask=function(layerId){if(layers.prop(layerId,"hasLayerMask")){throw new Error("Unable to add layer mask: layer already has one.");}if(layers.prop(layerId,"isBackgroundLayer")){layers.makeLayerFromBackground();layers.stack.makeBottomActive();}else{if(typeof layerId==="number"){layers.stack.makeActive(layerId);}}var ref=new ActionReference();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));var desc=new ActionDescriptor();desc.putClass(c2id("Nw  "),c2id("Chnl"));desc.putReference(c2id("At  "),ref);try{tmpTest=app.activeDocument.selection.bounds.length;desc.putEnumerated(c2id("Usng"),c2id("UsrM"),c2id("RvlS"));}catch(err){desc.putEnumerated(c2id("Usng"),c2id("UsrM"),c2id("RvlA"));}executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.masks.addVectorMask=function(layerId){if(layers.prop(layerId,"hasVectorMask")){throw new Error("Unable to add vector mask: layer already has one.");}if(layers.prop(layerId,"isBackgroundLayer")){layers.makeLayerFromBackground();}if(typeof layerId==="number"){layers.stack.makeActive(layerId);}var ref=new ActionReference();ref.putClass(c2id("Path"));var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);var ref2=new ActionReference();ref2.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));desc.putReference(c2id("At  "),ref2);desc.putEnumerated(c2id("Usng"),s2id("vectorMaskEnabled"),c2id("RvlA"));executeAction(c2id("Mk  "),desc,_dialogModesNo);return layers;};layers.masks.removeLayerMask=function(){_overloadFunction_Number_Bool(arguments,undefined,false);var layerId=arguments[0],apply=arguments[1];var ref=new ActionReference();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putBoolean(c2id("Aply"),apply);executeAction(c2id("Dlt "),desc,_dialogModesNo);return layers;};layers.masks.removeVectorMask=function(){_overloadFunction_Number_Bool(arguments,undefined,false);var layerId=arguments[0],apply=arguments[1],desc=new ActionDescriptor();if(apply){var hasUserMask=layers.masks.hasLayerMask(layerId);var rasterizeLayerId=s2id("rasterizeLayer");layers.stack.saveActiveIds(rasterizeLayerId);layers.stack.makeActive(layerId);desc.putReference(c2id("null"),layers.ref(layerId));desc.putEnumerated(c2id("What"),s2id("rasterizeItem"),s2id("vectorMask"));executeAction(rasterizeLayerId,desc,DialogModes.NO);if(!hasUserMask){layers.masks.removeLayerMask(layerId,true);}layers.stack.restoreIdList(rasterizeLayerId);}else{var ref=new ActionReference();ref.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));_getLayerIdRef(layerId,ref);desc.putReference(c2id("null"),ref);executeAction(c2id("Dlt "),desc,_dialogModesNo);}return layers;};layers.masks.makeLayerMaskActive=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],active=arguments[1];var channel=(active)?"Msk ":"RGB ";var ref=new ActionReference(),desc=new ActionDescriptor();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id(channel));_getLayerIdRef(layerId,ref);desc.putReference(c2id("null"),ref);executeAction(c2id("slct"),desc,_dialogModesNo);return layers;};layers.masks.makeVectorMaskActive=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],active=arguments[1];var ref=new ActionReference(),desc=new ActionDescriptor(),execId;if(active){ref.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));_getLayerIdRef(layerId,ref);execId=c2id("slct");}else{ref.putClass(c2id("Path"));_getLayerIdRef(layerId,ref);execId=c2id("Dslc");}desc.putReference(c2id("null"),ref);executeAction(execId,desc,_dialogModesNo);return layers;};layers.masks.makeLayerMaskVisible=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],visible=arguments[1];var ref=new ActionReference(),desc=new ActionDescriptor();ref.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));_getLayerIdRef(layerId,ref);desc.putReference(c2id("null"),ref);desc.putBoolean(c2id("MkVs"),visible);executeAction(c2id("slct"),desc,_dialogModesNo);return layers;};layers.masks.enable=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],enable=arguments[1];if(layers.masks.hasLayerMask(layerId)){layers.masks.enableLayerMask(layerId,enable);}if(layers.masks.hasVectorMask(layerId)){layers.masks.enableVectorMask(layerId,enable);}return layers;};layers.masks.enableLayerMask=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],enable=arguments[1];layers.prop(layerId,"layerMaskEnabled",enable);return layers;};layers.masks.enableVectorMask=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],enable=arguments[1];layers.prop(layerId,"vectorMaskEnabled",enable);return layers;};layers.masks.selectLayerMask=function(layerId){var ref=new ActionReference();ref.putProperty(c2id("Chnl"),c2id("fsel"));var ref2=new ActionReference();ref2.putEnumerated(c2id("Chnl"),c2id("Chnl"),c2id("Msk "));_getLayerIdRef(layerId,ref);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("T   "),ref2);executeAction(c2id("setd"),desc,_dialogModesNo);return layers;};layers.masks.selectVectorMask=function(layerId){var ref=new ActionReference();ref.putProperty(c2id("Chnl"),c2id("fsel"));var ref2=new ActionReference();ref2.putEnumerated(c2id("Path"),c2id("Path"),s2id("vectorMask"));_getLayerIdRef(layerId,ref2);var desc=new ActionDescriptor();desc.putReference(c2id("null"),ref);desc.putReference(c2id("T   "),ref2);desc.putInteger(c2id("Vrsn"),1);desc.putBoolean(s2id("vectorMaskParams"),true);executeAction(c2id("setd"),desc,_dialogModesNo);return layers;};layers.masks.setMaskLink=function(){_overloadFunction_Number_Bool(arguments,undefined,true);var layerId=arguments[0],setLink=arguments[1];if(layers.masks.hasLayerMask(layerId)){layers.masks.setLayerMaskLink(layerId,setLink);}if(layers.masks.hasVectorMask(layerId)){layers.masks.setVectorMaskLink(layerId,setLink);}return layers;};layers.masks.setLayerMaskLink=function(){_overloadFunction_Number_Bool(arguments,undefined,true);if(layers.masks.hasLayerMask(arguments[0])){layers.prop(arguments[0],"layerMaskLinked",arguments[1]);}};layers.masks.setVectorMaskLink=function(){_overloadFunction_Number_Bool(arguments,undefined,true);if(layers.masks.hasLayerMask(arguments[0])){layers.prop(arguments[0],"vectorMaskLinked",arguments[1]);}return layers;};layers.masks.refineLayerMask=function(layerId,edgeBorderRadius,edgeBorderContrast,edgeSmooth,edgeFeatherRadius,edgeChoke,edgeAutoRadius,edgeDecontaminate){typeof edgeBorderRadius==="number"||(edgeBorderRadius=0);typeof edgeBorderContrast==="number"||(edgeBorderContrast=0);typeof edgeSmooth==="number"||(edgeSmooth=0);typeof edgeFeatherRadius==="number"||(edgeFeatherRadius=0);typeof edgeChoke==="number"||(edgeChoke=0);typeof edgeAutoRadius==="boolean"||(edgeAutoRadius=false);typeof edgeDecontaminate==="boolean"||(edgeDecontaminate=false);var desc=new ActionDescriptor();desc.putReference(c2id("null"),layers.ref(layerId));desc.putUnitDouble(s2id("refineEdgeBorderRadius"),c2id("#Pxl"),Math.abs(edgeBorderRadius));desc.putUnitDouble(s2id("refineEdgeBorderContrast"),idPrc,Math.abs(edgeBorderContrast));desc.putInteger(s2id("refineEdgeSmooth"),Math.abs(Math.ceil(edgeSmooth)));desc.putUnitDouble(s2id("refineEdgeFeatherRadius"),c2id("#Pxl"),Math.abs(edgeFeatherRadius));desc.putUnitDouble(s2id("refineEdgeChoke"),c2id("#Prc"),Math.abs(edgeChoke));desc.putBoolean(s2id("refineEdgeAutoRadius"),edgeAutoRadius);desc.putBoolean(s2id("refineEdgeDecontaminate"),edgeDecontaminate);desc.putEnumerated(s2id("refineEdgeOutput"),s2id("refineEdgeOutput"),s2id("refineEdgeOutputUserMask"));executeAction(s2id("refineSelectionEdge"),desc,_dialogModesNo);return layers;};layers.masks.invertLayerMask=function(layerId){layers.masks.makeLayerMaskVisible(layerId,true);executeAction(c2id("Invr"),undefined,DialogModes.NO);layers.masks.makeLayerMaskVisible(layerId,false);return layers;};layers.shapes={};layers.shapes.getFillColor=function(){var ref=new ActionReference();if(typeof layerId!=="number"||layerId===0){ref.putEnumerated(s2id("contentLayer"),c2id("Ordn"),c2id("Trgt"));}else{ref.putIdentifier(s2id("contentLayer"),layerId);}var ref1=executeActionGet(ref);var list=ref1.getList(c2id("Adjs"));var solidColorLayer=list.getObjectValue(0);var color=solidColorLayer.getObjectValue(s2id("color"));var fillColor=new SolidColor();fillColor.rgb.red=color.getDouble(c2id("Rd  "));fillColor.rgb.green=color.getDouble(c2id("Grn "));fillColor.rgb.blue=color.getDouble(c2id("Bl  "));return fillColor;};layers.shapes.setFillColor=function(layerId,fillColor){fillColor=Lifter.colors.toSolidColor(fillColor);var ref=new ActionReference();if(typeof layerId!=="number"||layerId===0){ref.putEnumerated(s2id("contentLayer"),c2id("Ordn"),c2id("Trgt"));}else{ref.putIdentifier(s2id("contentLayer"),layerId);}var descSet=new ActionDescriptor();var descColor=Lifter.colors.toActionDescriptor(fillColor);descSet.putReference(c2id("null"),ref);descSet.putObject(s2id("to"),s2id("solidColorLayer"),descColor);executeAction(s2id("set"),descSet,DialogModes.NO);return layers;};layers.shapes.setStroke=function shapeSetStroke(bEnabled,fillColor,iWidth,sAlignment){var ref=new ActionReference();if(typeof layerId!=="number"||layerId===0){ref.putEnumerated(s2id("contentLayer"),c2id("Ordn"),c2id("Trgt"));}else{ref.putIdentifier(s2id("contentLayer"),layerId);}try{var descSet=new ActionDescriptor();ref.putEnumerated(s2id("contentLayer"),c2id("Ordn"),s2id("targetEnum"));descSet.putReference(c2id("null"),ref);var descStroke=new ActionDescriptor();var descStrokeStyle=new ActionDescriptor();if(typeof fillColor==="object"||typeof fillColor==="string"){var descColor=Lifter.colors.toActionDescriptor(fillColor);descStrokeStyle.putObject(s2id("strokeStyleContent"),s2id("solidColorLayer"),descColor);}if(typeof sAlignment!=="undefined"){var idstrokeStyleLineAlignment=s2id("strokeStyleLineAlignment");descStrokeStyle.putEnumerated(idstrokeStyleLineAlignment,idstrokeStyleLineAlignment,s2id("strokeStyleAlign"+sAlignment));}descStrokeStyle.putBoolean(s2id("strokeEnabled"),bEnabled);if(typeof iWidth!=="undefined"){descStrokeStyle.putUnitDouble(s2id("strokeStyleLineWidth"),c2id("#Pxl"),iWidth);}descStroke.putObject(s2id("strokeStyle"),s2id("strokeStyle"),descStrokeStyle);descSet.putObject(s2id("to"),s2id("shapeStyle"),descStroke);executeAction(s2id("set"),descSet,DialogModes.NO);}catch(e){log.error(e);}return layers;};layers.shapes.drawCustomShape=function shapesDrawCustomShape(aAnchorPositions,color,opacity,name){var oSubPath;var oPathItem;var aPathPoints=[];var y=aAnchorPositions.length;var i=0;for(i=0;i<y;i++){aPathPoints[i]=new PathPointInfo();aPathPoints[i].kind=PointKind.CORNERPOINT;aPathPoints[i].anchor=aAnchorPositions[i];aPathPoints[i].leftDirection=aPathPoints[i].anchor;aPathPoints[i].rightDirection=aPathPoints[i].anchor;}oSubPath=new SubPathInfo();oSubPath.closed=true;oSubPath.operation=ShapeOperation.SHAPEADD;oSubPath.entireSubPath=aPathPoints;oPathItem=app.activeDocument.oPathItems.add("tmpPath",[oSubPath]);var descUsng=new ActionDescriptor();var descType=new ActionDescriptor();var descClr=new ActionDescriptor();var descRGB=Lifter.colors.toActionDescriptor(color);var refLyr=new ActionReference();refLyr.putClass(s2t("contentLayer"));descUsng.putReference(c2t("null"),refLyr);descClr.putObject(s2t("color"),s2t("RGBColor"),descRGB);descType.putObject(c2t("Type"),s2t("solidColorLayer"),descClr);descUsng.putObject(c2t("Usng"),s2t("contentLayer"),descType);if(typeof name!==undefined&&name.constructor.name==="String"){descClr.putString(charIDToTypeID("Nm  "),name);}if(typeof opacity!==undefined&&typeof opacity!==null){descClr.putUnitDouble(charIDToTypeID("Opct"),charIDToTypeID("#Prc"),opacity);}executeAction(s2t("make"),descUsng,DialogModes.NO);oPathItem.remove();};layers.shapes.drawShape=function shapesDrawShape(shape,x,y,w,h,options){var shapeCID;var opts=(isDef(options))?options:{};var color=Lifter.colors.toArray(opts.color);var opacity=opts.opacity;var name=opts.name;var corners=opts.corners;if(typeof opts.corners==="number"){corners=[opts.corners,opts.corners,opts.corners,opts.corners];}else{if(opts.corners instanceof Array&&opts.corners.length===1){corners=[opts.corners[0],opts.corners[0],opts.corners[0],opts.corners[0]];}}switch(shape){case"Ellipse":case"Elps":shapeCID="Elps";break;case"Rectangle":case"Rctn":default:shapeCID="Rctn";break;}var descUsng=new ActionDescriptor();var refContentLayer=new ActionReference();refContentLayer.putClass(s2id("contentLayer"));descUsng.putReference(c2id("null"),refContentLayer);var descColorLayer=new ActionDescriptor();var descColor=Lifter.colors.toActionDescriptor(color);descColorLayer.putObject(c2id("Type"),s2id("solidColorLayer"),descColor);var descShape=new ActionDescriptor();var idPxl=c2id("#Pxl");descShape.putInteger(s2id("unitValueQuadVersion"),1);descShape.putUnitDouble(c2id("Top "),idPxl,y);descShape.putUnitDouble(c2id("Left"),idPxl,x);descShape.putUnitDouble(c2id("Btom"),idPxl,y+h);descShape.putUnitDouble(c2id("Rght"),idPxl,x+w);if(typeof corners!=="undefined"&&corners.length===4){descShape.putUnitDouble(s2id("topLeft"),idPxl,corners[0]);descShape.putUnitDouble(s2id("topRight"),idPxl,corners[1]);descShape.putUnitDouble(s2id("bottomRight"),idPxl,corners[2]);descShape.putUnitDouble(s2id("bottomLeft"),idPxl,corners[3]);}descColorLayer.putObject(c2id("Shp "),c2id(shapeCID),descShape);if(typeof opacity!=="undefined"&&typeof opacity!==null){descColorLayer.putUnitDouble(charIDToTypeID("Opct"),charIDToTypeID("#Prc"),opacity);}descUsng.putObject(c2id("Usng"),s2id("contentLayer"),descColorLayer);try{executeAction(c2id("Mk  "),descUsng,DialogModes.NO);}catch(e){log.error(e);return;}if(isDef(name)&&typeof name==="string"){layers.prop("name",name);}return layers.prop("layerId");};layers.shapes.drawEllipse=function shapesDrawEllipse(x,y,w,h,opts){return this.drawShape("Ellipse",x,y,w,h,opts);};layers.shapes.drawRect=function shapesDrawRect(x,y,w,h,opts){return this.drawShape("Rectangle",x,y,w,h,opts);};layers.rasterize=function(layerId){var rasterizeLayerId=s2id("rasterizeLayer");layers.stack.saveActiveIds(rasterizeLayerId);layers.stack.makeActive(layerId);if(layers.isGroup(layerId)){layers.groups.merge(layerId);}else{var desc=new ActionDescriptor();desc.putReference(c2id("null"),layers.ref());executeAction(s2id("rasterizeLayer"),desc,_dialogModesNo);}layers.stack.restoreIdList(rasterizeLayerId);return layers;};layers.setLocked=function(layerId,setLocked){setLocked=(setLocked!==false);layers.prop(layerId,"allLocked",setLocked);return layers;};layers.toggleIsolate=function(layerId){var ref=new ActionReference();_getLayerIdRef(layerId,ref);var list=new ActionList();list.putReference(ref);var desc=new ActionDescriptor();desc.putList(c2id("null"),list);desc.putBoolean(c2id("TglO"),true);executeAction(c2id("Shw "),desc,_dialogModesNo);return layers;},Lifter.layers=layers;log.debug("Lifter.layers done...");}());log.log("Lifter is ready now.");}).call($.global);}
/*!
 * LIFTER IS READY NOW
 */
;